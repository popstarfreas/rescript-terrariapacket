module ConnectRequest = Packetv1405_ConnectRequest
module Disconnect = Packet_Disconnect
module PlayerSlotSet = Packet_PlayerSlotSet
module PlayerInfo = Packetv1405_PlayerInfo
module PlayerInventorySlot = Packet_PlayerInventorySlot
module WorldDataRequest = Packet_WorldDataRequest
module WorldInfo = Packetv1405_WorldInfo
module InitialTileSectionsRequest = Packet_InitialTileSectionsRequest
module Status = Packet_Status
module TileSectionSend = Packetv1405_TileSectionSend
module TileSectionFrame = Packet_TileSectionFrame
module PlayerSpawn = Packetv1405_PlayerSpawn
module PlayerUpdate = Packet_PlayerUpdate
module PlayerActive = Packet_PlayerActive
module PlayerHealth = Packet_PlayerHealth
module TileModify = Packet_TileModify
module TimeSet = Packet_TimeSet
module DoorUse = Packet_DoorUse
module TileSquareSend = Packetv1405_TileSquareSend
module ItemDropUpdate = Packet_ItemDropUpdate
module ItemOwner = Packet_ItemOwner
module NpcUpdate = Packet_NpcUpdate
module NpcItemStrike = Packet_NpcItemStrike
module ProjectileSync = Packetv1405_ProjectileSync
module NpcStrike = Packet_NpcStrike
module ProjectileDestroy = Packet_ProjectileDestroy
module PvpToggle = Packet_PvpToggle
module ChestOpen = Packet_ChestOpen
module ChestItem = Packet_ChestItem
module ActiveContainerSync = Packet_ActiveContainerSync
module ChestPlace = Packet_ChestPlace
module HealEffect = Packet_HealEffect
module Zones = Packet_Zones
module PasswordRequired = Packet_PasswordRequired
module PasswordSend = Packet_PasswordSend
module ItemOwnerRemove = Packet_ItemOwnerRemove
module NpcTalk = Packet_NpcTalk
module PlayerAnimation = Packet_PlayerAnimation
module PlayerMana = Packet_PlayerMana
module ManaEffect = Packet_ManaEffect
module PlayerTeam = Packet_PlayerTeam
module SignRead = Packet_SignRead
module SignNew = Packet_SignNew
module LiquidSet = Packet_LiquidSet
module PlayerSpawnSelf = Packet_PlayerSpawnSelf
module PlayerBuffsSet = Packetv1405_PlayerBuffsSet
module NpcSpecialEffect = Packet_NpcSpecialEffect
module ChestOrTempleUnlock = Packet_ChestOrTempleUnlock
module NpcBuffAdd = Packet_NpcBuffAdd
module NpcBuffUpdate = Packetv1405_NpcBuffUpdate
module PlayerBuffAdd = Packet_PlayerBuffAdd
module NpcNameUpdate = Packet_NpcNameUpdate
module GoodEvilUpdate = Packet_GoodEvilUpdate
module HarpPlay = Packet_HarpPlay
module SwitchHit = Packet_SwitchHit
module NpcHomeUpdate = Packet_NpcHomeUpdate
module BossOrInvasionSpawn = Packet_BossOrInvasionSpawn
module PlayerDodge = Packet_PlayerDodge
module TilePaint = Packet_TilePaint
module WallPaint = Packet_WallPaint
module Teleport = Packet_Teleport
module PlayerHealOther = Packet_PlayerHealOther
module DimensionsUpdate = Packet_DimensionsUpdate
module ClientUuid = Packet_ClientUuid
module ChestName = Packet_ChestName
module NpcCatch = Packet_NpcCatch
module NpcRelease = Packet_NpcRelease
module TravellingMerchantInventory = Packet_TravellingMerchantInventory
module TeleportationPotion = Packet_TeleportationPotion
module AnglerQuest = Packet_AnglerQuest
module AnglerQuestComplete = Packet_AnglerQuestComplete
module AnglerQuestsCompletedAmount = Packet_AnglerQuestsCompletedAmount
module TemporaryAnimationCreate = Packet_TemporaryAnimationCreate
module InvasionProgressReport = Packet_InvasionProgressReport
module ObjectPlace = Packet_ObjectPlace
module PlayerChestIndexSync = Packet_PlayerChestIndexSync
module CombatNumberCreate = Packet_CombatNumberCreate
module NetModuleLoad = Packet_NetModuleLoad
module NpcKillCount = Packet_NpcKillCount
module PlayerStealth = Packet_PlayerStealth
module ItemForceIntoNearestChest = Packet_ItemForceIntoNearestChest
module TileEntityUpdate = Packet_TileEntityUpdate
module TileEntityPlace = Packet_TileEntityPlace
module ItemDropModify = Packet_ItemDropModify
module ItemFramePlace = Packet_ItemFramePlace
module ItemDropInstancedUpdate = Packet_ItemDropInstancedUpdate
module EmoteBubble = Packet_EmoteBubble
module ExtraValueSync = Packet_ExtraValueSync
module SocialHandshake = Packet_SocialHandshake
module Unused = Packet_Unused
module PortalKill = Packet_PortalKill
module PlayerTeleportPortal = Packet_PlayerTeleportPortal
module NpcKilledNotification = Packet_NpcKilledNotification
module EventNotification = Packet_EventNotification
module MinionTargetUpdate = Packet_MinionTargetUpdate
module NpcTeleportPortal = Packet_NpcTeleportPortal
module ShieldStrengthsUpdate = Packet_ShieldStrengthsUpdate
module NebulaLevelUp = Packet_NebulaLevelUp
module MoonLordCountdown = Packetv1405_MoonLordCountdown
module NpcShopItem = Packet_NpcShopItem
module GemLockToggle = Packet_GemLockToggle
module SmokePoof = Packet_SmokePoof
module ChatMessageSmart = Packet_ChatMessageSmart
module WiredCannonShot = Packet_WiredCannonShot
module MassWireOperation = Packet_MassWireOperation
module MassWireOperationPay = Packet_MassWireOperationPay
module PartyToggle = Packet_PartyToggle
module TreeGrowFx = Packet_TreeGrowFx
module CrystalInvasionStart = Packet_CrystalInvasionStart
module CrystalInvasionWipeAll = Packet_CrystalInvasionWipeAll
module MinionAttackTargetUpdate = Packet_MinionAttackTargetUpdate
module CrystalInvasionSendWaitTime = Packet_CrystalInvasionSendWaitTime
module PlayerDamage = Packet_PlayerDamage
module PlayerDeath = Packet_PlayerDeath
module CombatTextCreate = Packet_CombatTextCreate
module Emoji = Packet_Emoji
module TileEntityDisplayDollItemSync = Packet_TileEntityDisplayDollItemSync
module TileEntityInteractionRequest = Packet_TileEntityInteractionRequest
module WeaponsRackTryPlacing = Packet_WeaponsRackTryPlacing
module TileEntityHatRackItemSync = Packet_TileEntityHatRackItemSync
module TilePickingSync = Packet_TilePickingSync
module RevengeMarkerSync = Packet_RevengeMarkerSync
module RevengeMarkerRemove = Packet_RevengeMarkerRemove
module GolfBallLandInCup = Packet_GolfBallLandInCup
module ClientFinishConnectingToServer = Packet_ClientFinishConnectingToServer
module NpcFishOut = Packet_NpcFishOut
module NpcTamper = Packet_NpcTamper
module LegacySoundPlay = Packet_LegacySoundPlay
module FoodPlatterTryPlacing = Packet_FoodPlatterTryPlacing
module PlayerLuckFactorsUpdate = Packetv1405_PlayerLuckFactorsUpdate
module PlayerDead = Packet_PlayerDead
module CavernMonsterTypeSync = Packet_CavernMonsterTypeSync
module NpcBuffRemovalRequest = Packet_NpcBuffRemovalRequest
module ClientSyncedInventory = Packet_ClientSyncedInventory
module CountsAsHostForGameplaySet = Packet_CountsAsHostForGameplaySet

@deriving(accessors)
type t =
  | ConnectRequest(ConnectRequest.t)
  | Disconnect(Disconnect.t)
  | PlayerSlotSet(PlayerSlotSet.t)
  | PlayerInfo(PlayerInfo.t)
  | PlayerInventorySlot(PlayerInventorySlot.t)
  | WorldDataRequest(WorldDataRequest.t)
  | WorldInfo(WorldInfo.t)
  | InitialTileSectionsRequest(InitialTileSectionsRequest.t)
  | Status(Status.t)
  | TileSectionSend(TileSectionSend.t)
  | TileSectionFrame(TileSectionFrame.t)
  | PlayerSpawn(PlayerSpawn.t)
  | PlayerUpdate(PlayerUpdate.t)
  | PlayerActive(PlayerActive.t)
  | PlayerHealth(PlayerHealth.t)
  | TileModify(TileModify.t)
  | TimeSet(TimeSet.t)
  | DoorUse(DoorUse.t)
  | TileSquareSend(TileSquareSend.t)
  | ItemDropUpdate(ItemDropUpdate.t)
  | ItemOwner(ItemOwner.t)
  | NpcUpdate(NpcUpdate.t)
  | NpcItemStrike(NpcItemStrike.t)
  | ProjectileSync(ProjectileSync.t)
  | NpcStrike(NpcStrike.t)
  | ProjectileDestroy(ProjectileDestroy.t)
  | PvpToggle(PvpToggle.t)
  | ChestOpen(ChestOpen.t)
  | ChestItem(ChestItem.t)
  | ActiveContainerSync(ActiveContainerSync.t)
  | ChestPlace(ChestPlace.t)
  | HealEffect(HealEffect.t)
  | Zones(Zones.t)
  | PasswordRequired(PasswordRequired.t)
  | PasswordSend(PasswordSend.t)
  | ItemOwnerRemove(ItemOwnerRemove.t)
  | NpcTalk(NpcTalk.t)
  | PlayerAnimation(PlayerAnimation.t)
  | PlayerMana(PlayerMana.t)
  | ManaEffect(ManaEffect.t)
  | PlayerTeam(PlayerTeam.t)
  | SignRead(SignRead.t)
  | SignNew(SignNew.t)
  | LiquidSet(LiquidSet.t)
  | PlayerSpawnSelf(PlayerSpawnSelf.t)
  | PlayerBuffsSet(PlayerBuffsSet.t)
  | NpcSpecialEffect(NpcSpecialEffect.t)
  | ChestOrTempleUnlock(ChestOrTempleUnlock.t)
  | NpcBuffAdd(NpcBuffAdd.t)
  | NpcBuffUpdate(NpcBuffUpdate.t)
  | PlayerBuffAdd(PlayerBuffAdd.t)
  | NpcNameUpdate(NpcNameUpdate.t)
  | GoodEvilUpdate(GoodEvilUpdate.t)
  | HarpPlay(HarpPlay.t)
  | SwitchHit(SwitchHit.t)
  | NpcHomeUpdate(NpcHomeUpdate.t)
  | BossOrInvasionSpawn(BossOrInvasionSpawn.t)
  | PlayerDodge(PlayerDodge.t)
  | TilePaint(TilePaint.t)
  | WallPaint(WallPaint.t)
  | Teleport(Teleport.t)
  | PlayerHealOther(PlayerHealOther.t)
  | DimensionsUpdate(DimensionsUpdate.t)
  | ClientUuid(ClientUuid.t)
  | ChestName(ChestName.t)
  | NpcCatch(NpcCatch.t)
  | NpcRelease(NpcRelease.t)
  | TravellingMerchantInventory(TravellingMerchantInventory.t)
  | TeleportationPotion(TeleportationPotion.t)
  | AnglerQuest(AnglerQuest.t)
  | AnglerQuestComplete(AnglerQuestComplete.t)
  | AnglerQuestsCompletedAmount(AnglerQuestsCompletedAmount.t)
  | TemporaryAnimationCreate(TemporaryAnimationCreate.t)
  | InvasionProgressReport(InvasionProgressReport.t)
  | ObjectPlace(ObjectPlace.t)
  | PlayerChestIndexSync(PlayerChestIndexSync.t)
  | CombatNumberCreate(CombatNumberCreate.t)
  | NetModuleLoad(NetModuleLoad.t)
  | NpcKillCount(NpcKillCount.t)
  | PlayerStealth(PlayerStealth.t)
  | ItemForceIntoNearestChest(ItemForceIntoNearestChest.t)
  | TileEntityUpdate(TileEntityUpdate.t)
  | TileEntityPlace(TileEntityPlace.t)
  | ItemDropModify(ItemDropModify.t)
  | ItemFramePlace(ItemFramePlace.t)
  | ItemDropInstancedUpdate(ItemDropInstancedUpdate.t)
  | EmoteBubble(EmoteBubble.t)
  | ExtraValueSync(ExtraValueSync.t)
  | SocialHandshake(SocialHandshake.t)
  | Unused(Unused.t)
  | PortalKill(PortalKill.t)
  | PlayerTeleportPortal(PlayerTeleportPortal.t)
  | NpcKilledNotification(NpcKilledNotification.t)
  | EventNotification(EventNotification.t)
  | MinionTargetUpdate(MinionTargetUpdate.t)
  | NpcTeleportPortal(NpcTeleportPortal.t)
  | ShieldStrengthsUpdate(ShieldStrengthsUpdate.t)
  | NebulaLevelUp(NebulaLevelUp.t)
  | MoonLordCountdown(MoonLordCountdown.t)
  | NpcShopItem(NpcShopItem.t)
  | GemLockToggle(GemLockToggle.t)
  | SmokePoof(SmokePoof.t)
  | ChatMessageSmart(ChatMessageSmart.t)
  | WiredCannonShot(WiredCannonShot.t)
  | MassWireOperation(MassWireOperation.t)
  | MassWireOperationPay(MassWireOperationPay.t)
  | PartyToggle(PartyToggle.t)
  | TreeGrowFx(TreeGrowFx.t)
  | CrystalInvasionStart(CrystalInvasionStart.t)
  | CrystalInvasionWipeAll(CrystalInvasionWipeAll.t)
  | MinionAttackTargetUpdate(MinionAttackTargetUpdate.t)
  | CrystalInvasionSendWaitTime(CrystalInvasionSendWaitTime.t)
  | PlayerDamage(PlayerDamage.t)
  | PlayerDeath(PlayerDeath.t)
  | CombatTextCreate(CombatTextCreate.t)
  | Emoji(Emoji.t)
  | TileEntityDisplayDollItemSync(TileEntityDisplayDollItemSync.t)
  | TileEntityInteractionRequest(TileEntityInteractionRequest.t)
  | WeaponsRackTryPlacing(WeaponsRackTryPlacing.t)
  | TileEntityHatRackItemSync(TileEntityHatRackItemSync.t)
  | TilePickingSync(TilePickingSync.t)
  | RevengeMarkerSync(RevengeMarkerSync.t)
  | RevengeMarkerRemove(RevengeMarkerRemove.t)
  | GolfBallLandInCup(GolfBallLandInCup.t)
  | ClientFinishConnectingToServer(ClientFinishConnectingToServer.t)
  | NpcFishOut(NpcFishOut.t)
  | NpcTamper(NpcTamper.t)
  | LegacySoundPlay(LegacySoundPlay.t)
  | FoodPlatterTryPlacing(FoodPlatterTryPlacing.t)
  | PlayerLuckFactorsUpdate(PlayerLuckFactorsUpdate.t)
  | PlayerDead(PlayerDead.t)
  | CavernMonsterTypeSync(CavernMonsterTypeSync.t)
  | NpcBuffRemovalRequest(NpcBuffRemovalRequest.t)
  | ClientSyncedInventory(ClientSyncedInventory.t)
  | CountsAsHostForGameplaySet(CountsAsHostForGameplaySet.t)

type same<'a> =
  | Same('a)
  | NotSame('a)

let toLatest = (packet: t, _fromServer: bool): same<Packet.t> => {
  switch packet {
  | ConnectRequest(connectRequest) => Same(Packet.ConnectRequest(connectRequest))
  | Disconnect(disconnect) => Same(Packet.Disconnect(disconnect))
  | PlayerSlotSet(playerSlotSet) => Same(Packet.PlayerSlotSet(playerSlotSet))
  | PlayerInfo(playerInfo) => NotSame(Packet.PlayerInfo(PlayerInfo.toLatest(playerInfo)))
  | PlayerInventorySlot(playerInventorySlot) =>
    Same(Packet.PlayerInventorySlot(playerInventorySlot))
  | WorldDataRequest(worldDataRequest) => Same(Packet.WorldDataRequest(worldDataRequest))
  | WorldInfo(worldInfo) => NotSame(Packet.WorldInfo(WorldInfo.toLatest(worldInfo)))
  | InitialTileSectionsRequest(initialTileSectionsRequest) =>
    Same(Packet.InitialTileSectionsRequest(initialTileSectionsRequest))
  | Status(status) => Same(Packet.Status(status))
  | TileSectionSend(tileSectionSend) =>
    Same(Packet.TileSectionSend(TileSectionSend.toLatest(tileSectionSend)))
  | TileSectionFrame(tileSectionFrame) => Same(Packet.TileSectionFrame(tileSectionFrame))
  | PlayerSpawn(playerSpawn) => NotSame(Packet.PlayerSpawn(PlayerSpawn.toLatest(playerSpawn)))
  | PlayerUpdate(playerUpdate) => Same(Packet.PlayerUpdate(playerUpdate))
  | PlayerActive(playerActive) => Same(Packet.PlayerActive(playerActive))
  | PlayerHealth(playerHealth) => Same(Packet.PlayerHealth(playerHealth))
  | TileModify(tileModify) => Same(Packet.TileModify(tileModify))
  | TimeSet(timeSet) => Same(Packet.TimeSet(timeSet))
  | DoorUse(doorUse) => Same(Packet.DoorUse(doorUse))
  | TileSquareSend(tileSquareSend) =>
    NotSame(Packet.TileSquareSend(TileSquareSend.toLatest(tileSquareSend)))
  | ItemDropUpdate(itemDropUpdate) => Same(Packet.ItemDropUpdate(itemDropUpdate))
  | ItemOwner(itemOwner) => Same(Packet.ItemOwner(itemOwner))
  | NpcUpdate(npcUpdate) => Same(Packet.NpcUpdate(npcUpdate))
  | NpcItemStrike(npcItemStrike) => Same(Packet.NpcItemStrike(npcItemStrike))
  | ProjectileSync(projectileSync) => Same(Packet.ProjectileSync(projectileSync))
  | NpcStrike(npcStrike) => Same(Packet.NpcStrike(npcStrike))
  | ProjectileDestroy(projectileDestroy) => Same(Packet.ProjectileDestroy(projectileDestroy))
  | PvpToggle(pvpToggle) => Same(Packet.PvpToggle(pvpToggle))
  | ChestOpen(chestOpen) => Same(Packet.ChestOpen(chestOpen))
  | ChestItem(chestItem) => Same(Packet.ChestItem(chestItem))
  | ActiveContainerSync(activeContainerSync) =>
    Same(Packet.ActiveContainerSync(activeContainerSync))
  | ChestPlace(chestPlace) => Same(Packet.ChestPlace(chestPlace))
  | HealEffect(healEffect) => Same(Packet.HealEffect(healEffect))
  | Zones(zones) => Same(Packet.Zones(zones))
  | PasswordRequired(passwordRequired) => Same(Packet.PasswordRequired(passwordRequired))
  | PasswordSend(passwordSend) => Same(Packet.PasswordSend(passwordSend))
  | ItemOwnerRemove(itemOwnerRemove) => Same(Packet.ItemOwnerRemove(itemOwnerRemove))
  | NpcTalk(npcTalk) => Same(Packet.NpcTalk(npcTalk))
  | PlayerAnimation(playerAnimation) => Same(Packet.PlayerAnimation(playerAnimation))
  | PlayerMana(playerMana) => Same(Packet.PlayerMana(playerMana))
  | ManaEffect(manaEffect) => Same(Packet.ManaEffect(manaEffect))
  | PlayerTeam(playerTeam) => Same(Packet.PlayerTeam(playerTeam))
  | SignRead(signRead) => Same(Packet.SignRead(signRead))
  | SignNew(signNew) => Same(Packet.SignNew(signNew))
  | LiquidSet(liquidSet) => Same(Packet.LiquidSet(liquidSet))
  | PlayerSpawnSelf(playerSpawnSelf) => Same(Packet.PlayerSpawnSelf(playerSpawnSelf))
  | PlayerBuffsSet(playerBuffsSet) =>
    NotSame(Packet.PlayerBuffsSet(PlayerBuffsSet.toLatest(playerBuffsSet)))
  | NpcSpecialEffect(npcSpecialEffect) => Same(Packet.NpcSpecialEffect(npcSpecialEffect))
  | ChestOrTempleUnlock(chestOrTempleUnlock) =>
    Same(Packet.ChestOrTempleUnlock(chestOrTempleUnlock))
  | NpcBuffAdd(npcBuffAdd) => Same(Packet.NpcBuffAdd(npcBuffAdd))
  | NpcBuffUpdate(npcBuffUpdate) =>
    NotSame(Packet.NpcBuffUpdate(NpcBuffUpdate.toLatest(npcBuffUpdate)))
  | PlayerBuffAdd(playerBuffAdd) => Same(Packet.PlayerBuffAdd(playerBuffAdd))
  | NpcNameUpdate(npcNameUpdate) => Same(Packet.NpcNameUpdate(npcNameUpdate))
  | GoodEvilUpdate(goodEvilUpdate) => Same(Packet.GoodEvilUpdate(goodEvilUpdate))
  | HarpPlay(harpPlay) => Same(Packet.HarpPlay(harpPlay))
  | SwitchHit(switchHit) => Same(Packet.SwitchHit(switchHit))
  | NpcHomeUpdate(npcHomeUpdate) => Same(Packet.NpcHomeUpdate(npcHomeUpdate))
  | BossOrInvasionSpawn(bossOrInvasionSpawn) =>
    Same(Packet.BossOrInvasionSpawn(bossOrInvasionSpawn))
  | PlayerDodge(playerDodge) => Same(Packet.PlayerDodge(playerDodge))
  | TilePaint(tilePaint) => Same(Packet.TilePaint(tilePaint))
  | WallPaint(wallPaint) => Same(Packet.WallPaint(wallPaint))
  | Teleport(teleport) => Same(Packet.Teleport(teleport))
  | PlayerHealOther(playerHealOther) => Same(Packet.PlayerHealOther(playerHealOther))
  | DimensionsUpdate(dimensionsUpdate) => Same(Packet.DimensionsUpdate(dimensionsUpdate))
  | ClientUuid(clientUuid) => Same(Packet.ClientUuid(clientUuid))
  | ChestName(chestName) => Same(Packet.ChestName(chestName))
  | NpcCatch(catchNpc) => Same(Packet.NpcCatch(catchNpc))
  | NpcRelease(releaseNpc) => Same(Packet.NpcRelease(releaseNpc))
  | TravellingMerchantInventory(travellingMerchantInventory) =>
    Same(Packet.TravellingMerchantInventory(travellingMerchantInventory))
  | TeleportationPotion(teleportationPotion) =>
    Same(Packet.TeleportationPotion(teleportationPotion))
  | AnglerQuest(anglerQuest) => Same(Packet.AnglerQuest(anglerQuest))
  | AnglerQuestComplete(anglerQuestComplete) =>
    Same(Packet.AnglerQuestComplete(anglerQuestComplete))
  | AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount) =>
    Same(Packet.AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount))
  | TemporaryAnimationCreate(temporaryAnimationCreate) =>
    Same(Packet.TemporaryAnimationCreate(temporaryAnimationCreate))
  | InvasionProgressReport(invasionProgressReport) =>
    Same(Packet.InvasionProgressReport(invasionProgressReport))
  | ObjectPlace(objectPlace) => Same(Packet.ObjectPlace(objectPlace))
  | PlayerChestIndexSync(playerChestIndexSync) =>
    Same(Packet.PlayerChestIndexSync(playerChestIndexSync))
  | CombatNumberCreate(combatNumberCreate) => Same(Packet.CombatNumberCreate(combatNumberCreate))
  | NetModuleLoad(netModuleLoad) => Same(Packet.NetModuleLoad(netModuleLoad))
  | NpcKillCount(npcKillCount) => Same(Packet.NpcKillCount(npcKillCount))
  | PlayerStealth(playerStealth) => Same(Packet.PlayerStealth(playerStealth))
  | ItemForceIntoNearestChest(itemForceIntoNearestChest) =>
    Same(Packet.ItemForceIntoNearestChest(itemForceIntoNearestChest))
  | TileEntityUpdate(tileEntityUpdate) => Same(Packet.TileEntityUpdate(tileEntityUpdate))
  | TileEntityPlace(tileEntityPlace) => Same(Packet.TileEntityPlace(tileEntityPlace))
  | ItemDropModify(itemDropModify) => Same(Packet.ItemDropModify(itemDropModify))
  | ItemFramePlace(itemFramePlace) => Same(Packet.ItemFramePlace(itemFramePlace))
  | ItemDropInstancedUpdate(itemDropInstancedUpdate) =>
    Same(Packet.ItemDropInstancedUpdate(itemDropInstancedUpdate))
  | EmoteBubble(emoteBubble) => Same(Packet.EmoteBubble(emoteBubble))
  | ExtraValueSync(extraValueSync) => Same(Packet.ExtraValueSync(extraValueSync))
  | SocialHandshake(socialHandshake) => Same(Packet.SocialHandshake(socialHandshake))
  | Unused(unused) => Same(Packet.Unused(unused))
  | PortalKill(portalKill) => Same(Packet.PortalKill(portalKill))
  | PlayerTeleportPortal(playerTeleportPortal) =>
    Same(Packet.PlayerTeleportPortal(playerTeleportPortal))
  | NpcKilledNotification(npcKilledNotification) =>
    Same(Packet.NpcKilledNotification(npcKilledNotification))
  | EventNotification(eventNotification) => Same(Packet.EventNotification(eventNotification))
  | MinionTargetUpdate(minionTargetUpdate) => Same(Packet.MinionTargetUpdate(minionTargetUpdate))
  | NpcTeleportPortal(npcTeleportPortal) => Same(Packet.NpcTeleportPortal(npcTeleportPortal))
  | ShieldStrengthsUpdate(shieldStrengthsUpdate) =>
    Same(Packet.ShieldStrengthsUpdate(shieldStrengthsUpdate))
  | NebulaLevelUp(nebulaLevelUp) => Same(Packet.NebulaLevelUp(nebulaLevelUp))
  | MoonLordCountdown(moonLordCountdown) =>
    NotSame(Packet.MoonLordCountdown(MoonLordCountdown.toLatest(moonLordCountdown)))
  | NpcShopItem(npcShopItem) => Same(Packet.NpcShopItem(npcShopItem))
  | GemLockToggle(gemLockToggle) => Same(Packet.GemLockToggle(gemLockToggle))
  | SmokePoof(smokePoof) => Same(Packet.SmokePoof(smokePoof))
  | ChatMessageSmart(chatMessageSmart) => Same(Packet.ChatMessageSmart(chatMessageSmart))
  | WiredCannonShot(wiredCannonShot) => Same(Packet.WiredCannonShot(wiredCannonShot))
  | MassWireOperation(massWireOperation) => Same(Packet.MassWireOperation(massWireOperation))
  | MassWireOperationPay(massWireOperationPay) =>
    Same(Packet.MassWireOperationPay(massWireOperationPay))
  | PartyToggle(partyToggle) => Same(Packet.PartyToggle(partyToggle))
  | TreeGrowFx(treeGrowFx) => Same(Packet.TreeGrowFx(treeGrowFx))
  | CrystalInvasionStart(crystalInvasionStart) =>
    Same(Packet.CrystalInvasionStart(crystalInvasionStart))
  | CrystalInvasionWipeAll(crystalInvasionWipeAll) =>
    Same(Packet.CrystalInvasionWipeAll(crystalInvasionWipeAll))
  | MinionAttackTargetUpdate(minionAttackTargetUpdate) =>
    Same(Packet.MinionAttackTargetUpdate(minionAttackTargetUpdate))
  | CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime) =>
    Same(Packet.CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime))
  | PlayerDamage(playerDamage) => Same(Packet.PlayerDamage(playerDamage))
  | PlayerDeath(playerDeath) => Same(Packet.PlayerDeath(playerDeath))
  | CombatTextCreate(combatTextCreate) => Same(Packet.CombatTextCreate(combatTextCreate))
  | Emoji(emoji) => Same(Packet.Emoji(emoji))
  | TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync) =>
    Same(Packet.TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync))
  | TileEntityInteractionRequest(tileEntityInteractionRequest) =>
    Same(Packet.TileEntityInteractionRequest(tileEntityInteractionRequest))
  | WeaponsRackTryPlacing(weaponsRackTryPlacing) =>
    Same(Packet.WeaponsRackTryPlacing(weaponsRackTryPlacing))
  | TileEntityHatRackItemSync(tileEntityHatRackItemSync) =>
    Same(Packet.TileEntityHatRackItemSync(tileEntityHatRackItemSync))
  | TilePickingSync(tilePickingSync) => Same(Packet.TilePickingSync(tilePickingSync))
  | RevengeMarkerSync(revengeMarkerSync) => Same(Packet.RevengeMarkerSync(revengeMarkerSync))
  | RevengeMarkerRemove(revengeMarkerRemove) =>
    Same(Packet.RevengeMarkerRemove(revengeMarkerRemove))
  | GolfBallLandInCup(golfBallLandInCup) => Same(Packet.GolfBallLandInCup(golfBallLandInCup))
  | ClientFinishConnectingToServer(clientFinishConnectingToServer) =>
    Same(Packet.ClientFinishConnectingToServer(clientFinishConnectingToServer))
  | NpcFishOut(npcFishOut) => Same(Packet.NpcFishOut(npcFishOut))
  | NpcTamper(npcTamper) => Same(Packet.NpcTamper(npcTamper))
  | LegacySoundPlay(legacySoundPlay) => Same(Packet.LegacySoundPlay(legacySoundPlay))
  | FoodPlatterTryPlacing(foodPlatterTryPlacing) =>
    Same(Packet.FoodPlatterTryPlacing(foodPlatterTryPlacing))
  | PlayerLuckFactorsUpdate(playerLuckFactorsUpdate) =>
    NotSame(
      Packet.PlayerLuckFactorsUpdate(PlayerLuckFactorsUpdate.toLatest(playerLuckFactorsUpdate)),
    )
  | PlayerDead(playerDead) => Same(Packet.PlayerDead(playerDead))
  | CavernMonsterTypeSync(cavernMonsterTypeSync) =>
    Same(Packet.CavernMonsterTypeSync(cavernMonsterTypeSync))
  | NpcBuffRemovalRequest(npcBuffRemovalRequest) =>
    Same(Packet.NpcBuffRemovalRequest(npcBuffRemovalRequest))
  | ClientSyncedInventory(clientSyncedInventory) =>
    Same(Packet.ClientSyncedInventory(clientSyncedInventory))
  | CountsAsHostForGameplaySet(countsAsHostForGameplaySet) =>
    Same(Packet.CountsAsHostForGameplaySet(countsAsHostForGameplaySet))
  }
}

let fromLatest = (packet: Packet.t, _fromServer: bool): option<same<t>> => {
  switch packet {
  | Packet.ConnectRequest(connectRequest) => Some(Same(ConnectRequest(connectRequest)))
  | Packet.Disconnect(disconnect) => Some(Same(Disconnect(disconnect)))
  | Packet.PlayerSlotSet(playerSlotSet) => Some(Same(PlayerSlotSet(playerSlotSet)))
  | Packet.PlayerInfo(playerInfo) =>
    PlayerInfo.fromLatest(playerInfo)->Option.map(p => NotSame(PlayerInfo(p)))
  | Packet.PlayerInventorySlot(playerInventorySlot) =>
    Some(Same(PlayerInventorySlot(playerInventorySlot)))
  | Packet.WorldDataRequest(worldDataRequest) => Some(Same(WorldDataRequest(worldDataRequest)))
  | Packet.WorldInfo(worldInfo) =>
    WorldInfo.fromLatest(worldInfo)->Option.map(p => NotSame(WorldInfo(p)))
  | Packet.InitialTileSectionsRequest(initialTileSectionsRequest) =>
    Some(Same(InitialTileSectionsRequest(initialTileSectionsRequest)))
  | Packet.Status(status) => Some(Same(Status(status)))
  | Packet.TileSectionSend(tileSectionSend) =>
    TileSectionSend.fromLatest(tileSectionSend)->Option.map(p => Same(TileSectionSend(p)))
  | Packet.TileSectionFrame(tileSectionFrame) => Some(Same(TileSectionFrame(tileSectionFrame)))
  | Packet.PlayerSpawn(playerSpawn) =>
    PlayerSpawn.fromLatest(playerSpawn)->Option.map(p => NotSame(PlayerSpawn(p)))
  | Packet.PlayerUpdate(playerUpdate) => Some(Same(PlayerUpdate(playerUpdate)))
  | Packet.PlayerActive(playerActive) => Some(Same(PlayerActive(playerActive)))
  | Packet.PlayerHealth(playerHealth) => Some(Same(PlayerHealth(playerHealth)))
  | Packet.TileModify(tileModify) => Some(Same(TileModify(tileModify)))
  | Packet.TimeSet(timeSet) => Some(Same(TimeSet(timeSet)))
  | Packet.DoorUse(doorUse) => Some(Same(DoorUse(doorUse)))
  | Packet.TileSquareSend(tileSquareSend) =>
    TileSquareSend.fromLatest(tileSquareSend)->Option.map(p => NotSame(TileSquareSend(p)))
  | Packet.ItemDropUpdate(itemDropUpdate) => Some(Same(ItemDropUpdate(itemDropUpdate)))
  | Packet.ItemOwner(itemOwner) => Some(Same(ItemOwner(itemOwner)))
  | Packet.NpcUpdate(npcUpdate) => Some(Same(NpcUpdate(npcUpdate)))
  | Packet.NpcItemStrike(npcItemStrike) => Some(Same(NpcItemStrike(npcItemStrike)))
  | Packet.ProjectileSync(projectileSync) => Some(Same(ProjectileSync(projectileSync)))
  | Packet.NpcStrike(npcStrike) => Some(Same(NpcStrike(npcStrike)))
  | Packet.ProjectileDestroy(projectileDestroy) => Some(Same(ProjectileDestroy(projectileDestroy)))
  | Packet.PvpToggle(pvpToggle) => Some(Same(PvpToggle(pvpToggle)))
  | Packet.ChestOpen(chestOpen) => Some(Same(ChestOpen(chestOpen)))
  | Packet.ChestItem(chestItem) => Some(Same(ChestItem(chestItem)))
  | Packet.ActiveContainerSync(activeContainerSync) =>
    Some(Same(ActiveContainerSync(activeContainerSync)))
  | Packet.ChestPlace(chestPlace) => Some(Same(ChestPlace(chestPlace)))
  | Packet.HealEffect(healEffect) => Some(Same(HealEffect(healEffect)))
  | Packet.Zones(zones) => Some(Same(Zones(zones)))
  | Packet.PasswordRequired(passwordRequired) => Some(Same(PasswordRequired(passwordRequired)))
  | Packet.PasswordSend(passwordSend) => Some(Same(PasswordSend(passwordSend)))
  | Packet.ItemOwnerRemove(itemOwnerRemove) => Some(Same(ItemOwnerRemove(itemOwnerRemove)))
  | Packet.NpcTalk(npcTalk) => Some(Same(NpcTalk(npcTalk)))
  | Packet.PlayerAnimation(playerAnimation) => Some(Same(PlayerAnimation(playerAnimation)))
  | Packet.PlayerMana(playerMana) => Some(Same(PlayerMana(playerMana)))
  | Packet.ManaEffect(manaEffect) => Some(Same(ManaEffect(manaEffect)))
  | Packet.PlayerTeam(playerTeam) => Some(Same(PlayerTeam(playerTeam)))
  | Packet.SignRead(signRead) => Some(Same(SignRead(signRead)))
  | Packet.SignNew(signNew) => Some(Same(SignNew(signNew)))
  | Packet.LiquidSet(liquidSet) => Some(Same(LiquidSet(liquidSet)))
  | Packet.PlayerSpawnSelf(playerSpawnSelf) => Some(Same(PlayerSpawnSelf(playerSpawnSelf)))
  | Packet.PlayerBuffsSet(playerBuffsSet) =>
    PlayerBuffsSet.fromLatest(playerBuffsSet)->Option.map(p => NotSame(PlayerBuffsSet(p)))
  | Packet.NpcSpecialEffect(npcSpecialEffect) => Some(Same(NpcSpecialEffect(npcSpecialEffect)))
  | Packet.ChestOrTempleUnlock(chestOrTempleUnlock) =>
    Some(Same(ChestOrTempleUnlock(chestOrTempleUnlock)))
  | Packet.NpcBuffAdd(npcBuffAdd) => Some(Same(NpcBuffAdd(npcBuffAdd)))
  | Packet.NpcBuffUpdate(npcBuffUpdate) =>
    NpcBuffUpdate.fromLatest(npcBuffUpdate)->Option.map(p => NotSame(NpcBuffUpdate(p)))
  | Packet.PlayerBuffAdd(playerBuffAdd) => Some(Same(PlayerBuffAdd(playerBuffAdd)))
  | Packet.NpcNameUpdate(npcNameUpdate) => Some(Same(NpcNameUpdate(npcNameUpdate)))
  | Packet.GoodEvilUpdate(goodEvilUpdate) => Some(Same(GoodEvilUpdate(goodEvilUpdate)))
  | Packet.HarpPlay(harpPlay) => Some(Same(HarpPlay(harpPlay)))
  | Packet.SwitchHit(switchHit) => Some(Same(SwitchHit(switchHit)))
  | Packet.NpcHomeUpdate(npcHomeUpdate) => Some(Same(NpcHomeUpdate(npcHomeUpdate)))
  | Packet.BossOrInvasionSpawn(bossOrInvasionSpawn) =>
    Some(Same(BossOrInvasionSpawn(bossOrInvasionSpawn)))
  | Packet.PlayerDodge(playerDodge) => Some(Same(PlayerDodge(playerDodge)))
  | Packet.TilePaint(tilePaint) => Some(Same(TilePaint(tilePaint)))
  | Packet.WallPaint(wallPaint) => Some(Same(WallPaint(wallPaint)))
  | Packet.Teleport(teleport) => Some(Same(Teleport(teleport)))
  | Packet.PlayerHealOther(playerHealOther) => Some(Same(PlayerHealOther(playerHealOther)))
  | Packet.DimensionsUpdate(dimensionsUpdate) => Some(Same(DimensionsUpdate(dimensionsUpdate)))
  | Packet.ClientUuid(clientUuid) => Some(Same(ClientUuid(clientUuid)))
  | Packet.ChestName(chestName) => Some(Same(ChestName(chestName)))
  | Packet.NpcCatch(catchNpc) => Some(Same(NpcCatch(catchNpc)))
  | Packet.NpcRelease(releaseNpc) => Some(Same(NpcRelease(releaseNpc)))
  | Packet.TravellingMerchantInventory(travellingMerchantInventory) =>
    Some(Same(TravellingMerchantInventory(travellingMerchantInventory)))
  | Packet.TeleportationPotion(teleportationPotion) =>
    Some(Same(TeleportationPotion(teleportationPotion)))
  | Packet.AnglerQuest(anglerQuest) => Some(Same(AnglerQuest(anglerQuest)))
  | Packet.AnglerQuestComplete(anglerQuestComplete) =>
    Some(Same(AnglerQuestComplete(anglerQuestComplete)))
  | Packet.AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount) =>
    Some(Same(AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount)))
  | Packet.TemporaryAnimationCreate(temporaryAnimationCreate) =>
    Some(Same(TemporaryAnimationCreate(temporaryAnimationCreate)))
  | Packet.InvasionProgressReport(invasionProgressReport) =>
    Some(Same(InvasionProgressReport(invasionProgressReport)))
  | Packet.ObjectPlace(objectPlace) => Some(Same(ObjectPlace(objectPlace)))
  | Packet.PlayerChestIndexSync(playerChestIndexSync) =>
    Some(Same(PlayerChestIndexSync(playerChestIndexSync)))
  | Packet.CombatNumberCreate(combatNumberCreate) =>
    Some(Same(CombatNumberCreate(combatNumberCreate)))
  | Packet.NetModuleLoad(netModuleLoad) => Some(Same(NetModuleLoad(netModuleLoad)))
  | Packet.NpcKillCount(npcKillCount) => Some(Same(NpcKillCount(npcKillCount)))
  | Packet.PlayerStealth(playerStealth) => Some(Same(PlayerStealth(playerStealth)))
  | Packet.ItemForceIntoNearestChest(itemForceIntoNearestChest) =>
    Some(Same(ItemForceIntoNearestChest(itemForceIntoNearestChest)))
  | Packet.TileEntityUpdate(tileEntityUpdate) => Some(Same(TileEntityUpdate(tileEntityUpdate)))
  | Packet.TileEntityPlace(tileEntityPlace) => Some(Same(TileEntityPlace(tileEntityPlace)))
  | Packet.ItemDropModify(itemDropModify) => Some(Same(ItemDropModify(itemDropModify)))
  | Packet.ItemFramePlace(itemFramePlace) => Some(Same(ItemFramePlace(itemFramePlace)))
  | Packet.ItemDropInstancedUpdate(itemDropInstancedUpdate) =>
    Some(Same(ItemDropInstancedUpdate(itemDropInstancedUpdate)))
  | Packet.EmoteBubble(emoteBubble) => Some(Same(EmoteBubble(emoteBubble)))
  | Packet.ExtraValueSync(extraValueSync) => Some(Same(ExtraValueSync(extraValueSync)))
  | Packet.SocialHandshake(socialHandshake) => Some(Same(SocialHandshake(socialHandshake)))
  | Packet.Unused(unused) => Some(Same(Unused(unused)))
  | Packet.PortalKill(portalKill) => Some(Same(PortalKill(portalKill)))
  | Packet.PlayerTeleportPortal(playerTeleportPortal) =>
    Some(Same(PlayerTeleportPortal(playerTeleportPortal)))
  | Packet.NpcKilledNotification(npcKilledNotification) =>
    Some(Same(NpcKilledNotification(npcKilledNotification)))
  | Packet.EventNotification(eventNotification) => Some(Same(EventNotification(eventNotification)))
  | Packet.MinionTargetUpdate(minionTargetUpdate) =>
    Some(Same(MinionTargetUpdate(minionTargetUpdate)))
  | Packet.NpcTeleportPortal(npcTeleportPortal) => Some(Same(NpcTeleportPortal(npcTeleportPortal)))
  | Packet.ShieldStrengthsUpdate(shieldStrengthsUpdate) =>
    Some(Same(ShieldStrengthsUpdate(shieldStrengthsUpdate)))
  | Packet.NebulaLevelUp(nebulaLevelUp) => Some(Same(NebulaLevelUp(nebulaLevelUp)))
  | Packet.MoonLordCountdown(moonLordCountdown) =>
    MoonLordCountdown.fromLatest(moonLordCountdown)->Option.map(p => NotSame(MoonLordCountdown(p)))
  | Packet.NpcShopItem(npcShopItem) => Some(Same(NpcShopItem(npcShopItem)))
  | Packet.GemLockToggle(gemLockToggle) => Some(Same(GemLockToggle(gemLockToggle)))
  | Packet.SmokePoof(smokePoof) => Some(Same(SmokePoof(smokePoof)))
  | Packet.ChatMessageSmart(chatMessageSmart) => Some(Same(ChatMessageSmart(chatMessageSmart)))
  | Packet.WiredCannonShot(wiredCannonShot) => Some(Same(WiredCannonShot(wiredCannonShot)))
  | Packet.MassWireOperation(massWireOperation) => Some(Same(MassWireOperation(massWireOperation)))
  | Packet.MassWireOperationPay(massWireOperationPay) =>
    Some(Same(MassWireOperationPay(massWireOperationPay)))
  | Packet.PartyToggle(partyToggle) => Some(Same(PartyToggle(partyToggle)))
  | Packet.TreeGrowFx(treeGrowFx) => Some(Same(TreeGrowFx(treeGrowFx)))
  | Packet.CrystalInvasionStart(crystalInvasionStart) =>
    Some(Same(CrystalInvasionStart(crystalInvasionStart)))
  | Packet.CrystalInvasionWipeAll(crystalInvasionWipeAll) =>
    Some(Same(CrystalInvasionWipeAll(crystalInvasionWipeAll)))
  | Packet.MinionAttackTargetUpdate(minionAttackTargetUpdate) =>
    Some(Same(MinionAttackTargetUpdate(minionAttackTargetUpdate)))
  | Packet.CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime) =>
    Some(Same(CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime)))
  | Packet.PlayerDamage(playerDamage) => Some(Same(PlayerDamage(playerDamage)))
  | Packet.PlayerDeath(playerDeath) => Some(Same(PlayerDeath(playerDeath)))
  | Packet.CombatTextCreate(combatTextCreate) => Some(Same(CombatTextCreate(combatTextCreate)))
  | Packet.Emoji(emoji) => Some(Same(Emoji(emoji)))
  | Packet.TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync) =>
    Some(Same(TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync)))
  | Packet.TileEntityInteractionRequest(tileEntityInteractionRequest) =>
    Some(Same(TileEntityInteractionRequest(tileEntityInteractionRequest)))
  | Packet.WeaponsRackTryPlacing(weaponsRackTryPlacing) =>
    Some(Same(WeaponsRackTryPlacing(weaponsRackTryPlacing)))
  | Packet.TileEntityHatRackItemSync(tileEntityHatRackItemSync) =>
    Some(Same(TileEntityHatRackItemSync(tileEntityHatRackItemSync)))
  | Packet.TilePickingSync(tilePickingSync) => Some(Same(TilePickingSync(tilePickingSync)))
  | Packet.RevengeMarkerSync(revengeMarkerSync) => Some(Same(RevengeMarkerSync(revengeMarkerSync)))
  | Packet.RevengeMarkerRemove(revengeMarkerRemove) =>
    Some(Same(RevengeMarkerRemove(revengeMarkerRemove)))
  | Packet.GolfBallLandInCup(golfBallLandInCup) => Some(Same(GolfBallLandInCup(golfBallLandInCup)))
  | Packet.ClientFinishConnectingToServer(clientFinishConnectingToServer) =>
    Some(Same(ClientFinishConnectingToServer(clientFinishConnectingToServer)))
  | Packet.NpcFishOut(npcFishOut) => Some(Same(NpcFishOut(npcFishOut)))
  | Packet.NpcTamper(npcTamper) => Some(Same(NpcTamper(npcTamper)))
  | Packet.LegacySoundPlay(legacySoundPlay) => Some(Same(LegacySoundPlay(legacySoundPlay)))
  | Packet.FoodPlatterTryPlacing(foodPlatterTryPlacing) =>
    Some(Same(FoodPlatterTryPlacing(foodPlatterTryPlacing)))
  | Packet.PlayerLuckFactorsUpdate(playerLuckFactorsUpdate) =>
    PlayerLuckFactorsUpdate.fromLatest(playerLuckFactorsUpdate)->Option.map(p => NotSame(
      PlayerLuckFactorsUpdate(p),
    ))
  | Packet.PlayerDead(playerDead) => Some(Same(PlayerDead(playerDead)))
  | Packet.CavernMonsterTypeSync(cavernMonsterTypeSync) =>
    Some(Same(CavernMonsterTypeSync(cavernMonsterTypeSync)))
  | Packet.NpcBuffRemovalRequest(npcBuffRemovalRequest) =>
    Some(Same(NpcBuffRemovalRequest(npcBuffRemovalRequest)))
  | Packet.ClientSyncedInventory(clientSyncedInventory) =>
    Some(Same(ClientSyncedInventory(clientSyncedInventory)))
  | Packet.CountsAsHostForGameplaySet(countsAsHostForGameplaySet) =>
    Some(Same(CountsAsHostForGameplaySet(countsAsHostForGameplaySet)))
  | Packet.CreditsOrSlimeTransform(_) => None
  | Packet.LucyAxeMessage(_) => None
  | Packet.PiggyBankVoidLensUpdate(_) => None
  | Packet.DungeonDefendersEventAttemptSkipWait(_) => None
  | Packet.HaveDryadDoStardewAnimation(_) => None
  | Packet.ItemDropShimmeredUpdate(_) => None
  | Packet.ShimmerEffectOrCoinLuck(_) => None
  | Packet.LoadoutSwitch(_) => None
  | Packet.ItemDropProtectedUpdate(_) => None
  }
}

module LazyPacket = {
  type lazyParsed<'a> = Lazy.t<result<'a, ErrorAwarePacketReader.readError>>
  type t =
    | ConnectRequest(lazyParsed<ConnectRequest.t>)
    | Disconnect(lazyParsed<Disconnect.t>)
    | PlayerSlotSet(lazyParsed<PlayerSlotSet.t>)
    | PlayerInfo(lazyParsed<PlayerInfo.t>)
    | PlayerInventorySlot(lazyParsed<PlayerInventorySlot.t>)
    | WorldDataRequest(lazyParsed<WorldDataRequest.t>)
    | WorldInfo(lazyParsed<WorldInfo.t>)
    | InitialTileSectionsRequest(lazyParsed<InitialTileSectionsRequest.t>)
    | Status(lazyParsed<Status.t>)
    | TileSectionSend(lazyParsed<TileSectionSend.t>)
    | TileSectionFrame(lazyParsed<TileSectionFrame.t>)
    | PlayerSpawn(lazyParsed<PlayerSpawn.t>)
    | PlayerUpdate(lazyParsed<PlayerUpdate.t>)
    | PlayerActive(lazyParsed<PlayerActive.t>)
    | PlayerHealth(lazyParsed<PlayerHealth.t>)
    | TileModify(lazyParsed<TileModify.t>)
    | TimeSet(lazyParsed<TimeSet.t>)
    | DoorUse(lazyParsed<DoorUse.t>)
    | TileSquareSend(lazyParsed<TileSquareSend.t>)
    | ItemDropUpdate(lazyParsed<ItemDropUpdate.t>)
    | ItemOwner(lazyParsed<ItemOwner.t>)
    | NpcUpdate(lazyParsed<NpcUpdate.t>)
    | NpcItemStrike(lazyParsed<NpcItemStrike.t>)
    | ProjectileSync(lazyParsed<ProjectileSync.t>)
    | NpcStrike(lazyParsed<NpcStrike.t>)
    | ProjectileDestroy(lazyParsed<ProjectileDestroy.t>)
    | PvpToggle(lazyParsed<PvpToggle.t>)
    | ChestOpen(lazyParsed<ChestOpen.t>)
    | ChestItem(lazyParsed<ChestItem.t>)
    | ActiveContainerSync(lazyParsed<ActiveContainerSync.t>)
    | ChestPlace(lazyParsed<ChestPlace.t>)
    | HealEffect(lazyParsed<HealEffect.t>)
    | Zones(lazyParsed<Zones.t>)
    | PasswordRequired(lazyParsed<PasswordRequired.t>)
    | PasswordSend(lazyParsed<PasswordSend.t>)
    | ItemOwnerRemove(lazyParsed<ItemOwnerRemove.t>)
    | NpcTalk(lazyParsed<NpcTalk.t>)
    | PlayerAnimation(lazyParsed<PlayerAnimation.t>)
    | PlayerMana(lazyParsed<PlayerMana.t>)
    | ManaEffect(lazyParsed<ManaEffect.t>)
    | PlayerTeam(lazyParsed<PlayerTeam.t>)
    | SignRead(lazyParsed<SignRead.t>)
    | SignNew(lazyParsed<SignNew.t>)
    | LiquidSet(lazyParsed<LiquidSet.t>)
    | PlayerSpawnSelf(lazyParsed<PlayerSpawnSelf.t>)
    | PlayerBuffsSet(lazyParsed<PlayerBuffsSet.t>)
    | NpcSpecialEffect(lazyParsed<NpcSpecialEffect.t>)
    | ChestOrTempleUnlock(lazyParsed<ChestOrTempleUnlock.t>)
    | NpcBuffAdd(lazyParsed<NpcBuffAdd.t>)
    | NpcBuffUpdate(lazyParsed<NpcBuffUpdate.t>)
    | PlayerBuffAdd(lazyParsed<PlayerBuffAdd.t>)
    | NpcNameUpdate(lazyParsed<NpcNameUpdate.t>)
    | GoodEvilUpdate(lazyParsed<GoodEvilUpdate.t>)
    | HarpPlay(lazyParsed<HarpPlay.t>)
    | SwitchHit(lazyParsed<SwitchHit.t>)
    | NpcHomeUpdate(lazyParsed<NpcHomeUpdate.t>)
    | BossOrInvasionSpawn(lazyParsed<BossOrInvasionSpawn.t>)
    | PlayerDodge(lazyParsed<PlayerDodge.t>)
    | TilePaint(lazyParsed<TilePaint.t>)
    | WallPaint(lazyParsed<WallPaint.t>)
    | Teleport(lazyParsed<Teleport.t>)
    | PlayerHealOther(lazyParsed<PlayerHealOther.t>)
    | DimensionsUpdate(lazyParsed<DimensionsUpdate.t>)
    | ClientUuid(lazyParsed<ClientUuid.t>)
    | ChestName(lazyParsed<ChestName.t>)
    | NpcCatch(lazyParsed<NpcCatch.t>)
    | NpcRelease(lazyParsed<NpcRelease.t>)
    | TravellingMerchantInventory(lazyParsed<TravellingMerchantInventory.t>)
    | TeleportationPotion(lazyParsed<TeleportationPotion.t>)
    | AnglerQuest(lazyParsed<AnglerQuest.t>)
    | AnglerQuestComplete(lazyParsed<AnglerQuestComplete.t>)
    | AnglerQuestsCompletedAmount(lazyParsed<AnglerQuestsCompletedAmount.t>)
    | TemporaryAnimationCreate(lazyParsed<TemporaryAnimationCreate.t>)
    | InvasionProgressReport(lazyParsed<InvasionProgressReport.t>)
    | ObjectPlace(lazyParsed<ObjectPlace.t>)
    | PlayerChestIndexSync(lazyParsed<PlayerChestIndexSync.t>)
    | CombatNumberCreate(lazyParsed<CombatNumberCreate.t>)
    | NetModuleLoad(lazyParsed<NetModuleLoad.t>)
    | NpcKillCount(lazyParsed<NpcKillCount.t>)
    | PlayerStealth(lazyParsed<PlayerStealth.t>)
    | ItemForceIntoNearestChest(lazyParsed<ItemForceIntoNearestChest.t>)
    | TileEntityUpdate(lazyParsed<TileEntityUpdate.t>)
    | TileEntityPlace(lazyParsed<TileEntityPlace.t>)
    | ItemDropModify(lazyParsed<ItemDropModify.t>)
    | ItemFramePlace(lazyParsed<ItemFramePlace.t>)
    | ItemDropInstancedUpdate(lazyParsed<ItemDropInstancedUpdate.t>)
    | EmoteBubble(lazyParsed<EmoteBubble.t>)
    | ExtraValueSync(lazyParsed<ExtraValueSync.t>)
    | SocialHandshake(lazyParsed<SocialHandshake.t>)
    | Unused(lazyParsed<Unused.t>)
    | PortalKill(lazyParsed<PortalKill.t>)
    | PlayerTeleportPortal(lazyParsed<PlayerTeleportPortal.t>)
    | NpcKilledNotification(lazyParsed<NpcKilledNotification.t>)
    | EventNotification(lazyParsed<EventNotification.t>)
    | MinionTargetUpdate(lazyParsed<MinionTargetUpdate.t>)
    | NpcTeleportPortal(lazyParsed<NpcTeleportPortal.t>)
    | ShieldStrengthsUpdate(lazyParsed<ShieldStrengthsUpdate.t>)
    | NebulaLevelUp(lazyParsed<NebulaLevelUp.t>)
    | MoonLordCountdown(lazyParsed<MoonLordCountdown.t>)
    | NpcShopItem(lazyParsed<NpcShopItem.t>)
    | GemLockToggle(lazyParsed<GemLockToggle.t>)
    | SmokePoof(lazyParsed<SmokePoof.t>)
    | ChatMessageSmart(lazyParsed<ChatMessageSmart.t>)
    | WiredCannonShot(lazyParsed<WiredCannonShot.t>)
    | MassWireOperation(lazyParsed<MassWireOperation.t>)
    | MassWireOperationPay(lazyParsed<MassWireOperationPay.t>)
    | PartyToggle(lazyParsed<PartyToggle.t>)
    | TreeGrowFx(lazyParsed<TreeGrowFx.t>)
    | CrystalInvasionStart(lazyParsed<CrystalInvasionStart.t>)
    | CrystalInvasionWipeAll(lazyParsed<CrystalInvasionWipeAll.t>)
    | MinionAttackTargetUpdate(lazyParsed<MinionAttackTargetUpdate.t>)
    | CrystalInvasionSendWaitTime(lazyParsed<CrystalInvasionSendWaitTime.t>)
    | PlayerDamage(lazyParsed<PlayerDamage.t>)
    | PlayerDeath(lazyParsed<PlayerDeath.t>)
    | CombatTextCreate(lazyParsed<CombatTextCreate.t>)
    | Emoji(lazyParsed<Emoji.t>)
    | TileEntityDisplayDollItemSync(lazyParsed<TileEntityDisplayDollItemSync.t>)
    | TileEntityInteractionRequest(lazyParsed<TileEntityInteractionRequest.t>)
    | WeaponsRackTryPlacing(lazyParsed<WeaponsRackTryPlacing.t>)
    | TileEntityHatRackItemSync(lazyParsed<TileEntityHatRackItemSync.t>)
    | TilePickingSync(lazyParsed<TilePickingSync.t>)
    | RevengeMarkerSync(lazyParsed<RevengeMarkerSync.t>)
    | RevengeMarkerRemove(lazyParsed<RevengeMarkerRemove.t>)
    | GolfBallLandInCup(lazyParsed<GolfBallLandInCup.t>)
    | ClientFinishConnectingToServer(lazyParsed<ClientFinishConnectingToServer.t>)
    | NpcFishOut(lazyParsed<NpcFishOut.t>)
    | NpcTamper(lazyParsed<NpcTamper.t>)
    | LegacySoundPlay(lazyParsed<LegacySoundPlay.t>)
    | FoodPlatterTryPlacing(lazyParsed<FoodPlatterTryPlacing.t>)
    | PlayerLuckFactorsUpdate(lazyParsed<PlayerLuckFactorsUpdate.t>)
    | PlayerDead(lazyParsed<PlayerDead.t>)
    | CavernMonsterTypeSync(lazyParsed<CavernMonsterTypeSync.t>)
    | NpcBuffRemovalRequest(lazyParsed<NpcBuffRemovalRequest.t>)
    | ClientSyncedInventory(lazyParsed<ClientSyncedInventory.t>)
    | CountsAsHostForGameplaySet(lazyParsed<CountsAsHostForGameplaySet.t>)

  let toLatest = (packet: t, _fromServer: bool): Packet.LazyPacket.t => {
    switch packet {
    | ConnectRequest(connectRequest) => Packet.LazyPacket.ConnectRequest(connectRequest)
    | Disconnect(disconnect) => Packet.LazyPacket.Disconnect(disconnect)
    | PlayerSlotSet(playerSlotSet) => Packet.LazyPacket.PlayerSlotSet(playerSlotSet)
    | PlayerInfo(playerInfo) =>
      Packet.LazyPacket.PlayerInfo(
        Lazy.make(() => playerInfo->Lazy.get->Result.map(PlayerInfo.toLatest)),
      )
    | PlayerInventorySlot(playerInventorySlot) =>
      Packet.LazyPacket.PlayerInventorySlot(playerInventorySlot)
    | WorldDataRequest(worldDataRequest) => Packet.LazyPacket.WorldDataRequest(worldDataRequest)
    | WorldInfo(worldInfo) =>
      Packet.LazyPacket.WorldInfo(
        Lazy.make(() => worldInfo->Lazy.get->Result.map(WorldInfo.toLatest)),
      )
    | InitialTileSectionsRequest(initialTileSectionsRequest) =>
      Packet.LazyPacket.InitialTileSectionsRequest(initialTileSectionsRequest)
    | Status(status) => Packet.LazyPacket.Status(status)
    | TileSectionSend(tileSectionSend) =>
      Packet.LazyPacket.TileSectionSend(
        Lazy.make(() =>
          tileSectionSend
          ->Lazy.get
          ->Result.map(TileSectionSend.toLatest)
        ),
      )
    | TileSectionFrame(tileSectionFrame) => Packet.LazyPacket.TileSectionFrame(tileSectionFrame)
    | PlayerSpawn(playerSpawn) =>
      Packet.LazyPacket.PlayerSpawn(
        Lazy.make(() => playerSpawn->Lazy.get->Result.map(PlayerSpawn.toLatest)),
      )
    | PlayerUpdate(playerUpdate) => Packet.LazyPacket.PlayerUpdate(playerUpdate)
    | PlayerActive(playerActive) => Packet.LazyPacket.PlayerActive(playerActive)
    | PlayerHealth(playerHealth) => Packet.LazyPacket.PlayerHealth(playerHealth)
    | TileModify(tileModify) => Packet.LazyPacket.TileModify(tileModify)
    | TimeSet(timeSet) => Packet.LazyPacket.TimeSet(timeSet)
    | DoorUse(doorUse) => Packet.LazyPacket.DoorUse(doorUse)
    | TileSquareSend(tileSquareSend) =>
      Packet.LazyPacket.TileSquareSend(
        Lazy.make(() =>
          tileSquareSend
          ->Lazy.get
          ->Result.map(TileSquareSend.toLatest)
        ),
      )
    | ItemDropUpdate(itemDropUpdate) => Packet.LazyPacket.ItemDropUpdate(itemDropUpdate)
    | ItemOwner(itemOwner) => Packet.LazyPacket.ItemOwner(itemOwner)
    | NpcUpdate(npcUpdate) => Packet.LazyPacket.NpcUpdate(npcUpdate)
    | NpcItemStrike(npcItemStrike) => Packet.LazyPacket.NpcItemStrike(npcItemStrike)
    | ProjectileSync(projectileSync) => Packet.LazyPacket.ProjectileSync(projectileSync)
    | NpcStrike(npcStrike) => Packet.LazyPacket.NpcStrike(npcStrike)
    | ProjectileDestroy(projectileDestroy) => Packet.LazyPacket.ProjectileDestroy(projectileDestroy)
    | PvpToggle(pvpToggle) => Packet.LazyPacket.PvpToggle(pvpToggle)
    | ChestOpen(chestOpen) => Packet.LazyPacket.ChestOpen(chestOpen)
    | ChestItem(chestItem) => Packet.LazyPacket.ChestItem(chestItem)
    | ActiveContainerSync(activeContainerSync) =>
      Packet.LazyPacket.ActiveContainerSync(activeContainerSync)
    | ChestPlace(chestPlace) => Packet.LazyPacket.ChestPlace(chestPlace)
    | HealEffect(healEffect) => Packet.LazyPacket.HealEffect(healEffect)
    | Zones(zones) => Packet.LazyPacket.Zones(zones)
    | PasswordRequired(passwordRequired) => Packet.LazyPacket.PasswordRequired(passwordRequired)
    | PasswordSend(passwordSend) => Packet.LazyPacket.PasswordSend(passwordSend)
    | ItemOwnerRemove(itemOwnerRemove) => Packet.LazyPacket.ItemOwnerRemove(itemOwnerRemove)
    | NpcTalk(npcTalk) => Packet.LazyPacket.NpcTalk(npcTalk)
    | PlayerAnimation(playerAnimation) => Packet.LazyPacket.PlayerAnimation(playerAnimation)
    | PlayerMana(playerMana) => Packet.LazyPacket.PlayerMana(playerMana)
    | ManaEffect(manaEffect) => Packet.LazyPacket.ManaEffect(manaEffect)
    | PlayerTeam(playerTeam) => Packet.LazyPacket.PlayerTeam(playerTeam)
    | SignRead(signRead) => Packet.LazyPacket.SignRead(signRead)
    | SignNew(signNew) => Packet.LazyPacket.SignNew(signNew)
    | LiquidSet(liquidSet) => Packet.LazyPacket.LiquidSet(liquidSet)
    | PlayerSpawnSelf(playerSpawnSelf) => Packet.LazyPacket.PlayerSpawnSelf(playerSpawnSelf)
    | PlayerBuffsSet(playerBuffsSet) =>
      Packet.LazyPacket.PlayerBuffsSet(
        Lazy.make(() => playerBuffsSet->Lazy.get->Result.map(PlayerBuffsSet.toLatest)),
      )
    | NpcSpecialEffect(npcSpecialEffect) => Packet.LazyPacket.NpcSpecialEffect(npcSpecialEffect)
    | ChestOrTempleUnlock(chestOrTempleUnlock) =>
      Packet.LazyPacket.ChestOrTempleUnlock(chestOrTempleUnlock)
    | NpcBuffAdd(npcBuffAdd) => Packet.LazyPacket.NpcBuffAdd(npcBuffAdd)
    | NpcBuffUpdate(npcBuffUpdate) =>
      Packet.LazyPacket.NpcBuffUpdate(
        Lazy.make(() => npcBuffUpdate->Lazy.get->Result.map(NpcBuffUpdate.toLatest)),
      )
    | PlayerBuffAdd(playerBuffAdd) => Packet.LazyPacket.PlayerBuffAdd(playerBuffAdd)
    | NpcNameUpdate(npcNameUpdate) => Packet.LazyPacket.NpcNameUpdate(npcNameUpdate)
    | GoodEvilUpdate(goodEvilUpdate) => Packet.LazyPacket.GoodEvilUpdate(goodEvilUpdate)
    | HarpPlay(harpPlay) => Packet.LazyPacket.HarpPlay(harpPlay)
    | SwitchHit(switchHit) => Packet.LazyPacket.SwitchHit(switchHit)
    | NpcHomeUpdate(npcHomeUpdate) => Packet.LazyPacket.NpcHomeUpdate(npcHomeUpdate)
    | BossOrInvasionSpawn(bossOrInvasionSpawn) =>
      Packet.LazyPacket.BossOrInvasionSpawn(bossOrInvasionSpawn)
    | PlayerDodge(playerDodge) => Packet.LazyPacket.PlayerDodge(playerDodge)
    | TilePaint(tilePaint) => Packet.LazyPacket.TilePaint(tilePaint)
    | WallPaint(wallPaint) => Packet.LazyPacket.WallPaint(wallPaint)
    | Teleport(teleport) => Packet.LazyPacket.Teleport(teleport)
    | PlayerHealOther(playerHealOther) => Packet.LazyPacket.PlayerHealOther(playerHealOther)
    | DimensionsUpdate(dimensionsUpdate) => Packet.LazyPacket.DimensionsUpdate(dimensionsUpdate)
    | ClientUuid(clientUuid) => Packet.LazyPacket.ClientUuid(clientUuid)
    | ChestName(chestName) => Packet.LazyPacket.ChestName(chestName)
    | NpcCatch(catchNpc) => Packet.LazyPacket.NpcCatch(catchNpc)
    | NpcRelease(releaseNpc) => Packet.LazyPacket.NpcRelease(releaseNpc)
    | TravellingMerchantInventory(travellingMerchantInventory) =>
      Packet.LazyPacket.TravellingMerchantInventory(travellingMerchantInventory)
    | TeleportationPotion(teleportationPotion) =>
      Packet.LazyPacket.TeleportationPotion(teleportationPotion)
    | AnglerQuest(anglerQuest) => Packet.LazyPacket.AnglerQuest(anglerQuest)
    | AnglerQuestComplete(anglerQuestComplete) =>
      Packet.LazyPacket.AnglerQuestComplete(anglerQuestComplete)
    | AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount) =>
      Packet.LazyPacket.AnglerQuestsCompletedAmount(anglerQuestsCompletedAmount)
    | TemporaryAnimationCreate(temporaryAnimationCreate) =>
      Packet.LazyPacket.TemporaryAnimationCreate(temporaryAnimationCreate)
    | InvasionProgressReport(invasionProgressReport) =>
      Packet.LazyPacket.InvasionProgressReport(invasionProgressReport)
    | ObjectPlace(objectPlace) => Packet.LazyPacket.ObjectPlace(objectPlace)
    | PlayerChestIndexSync(playerChestIndexSync) =>
      Packet.LazyPacket.PlayerChestIndexSync(playerChestIndexSync)
    | CombatNumberCreate(combatNumberCreate) =>
      Packet.LazyPacket.CombatNumberCreate(combatNumberCreate)
    | NetModuleLoad(netModuleLoad) => Packet.LazyPacket.NetModuleLoad(netModuleLoad)
    | NpcKillCount(npcKillCount) => Packet.LazyPacket.NpcKillCount(npcKillCount)
    | PlayerStealth(playerStealth) => Packet.LazyPacket.PlayerStealth(playerStealth)
    | ItemForceIntoNearestChest(itemForceIntoNearestChest) =>
      Packet.LazyPacket.ItemForceIntoNearestChest(itemForceIntoNearestChest)
    | TileEntityUpdate(tileEntityUpdate) => Packet.LazyPacket.TileEntityUpdate(tileEntityUpdate)
    | TileEntityPlace(tileEntityPlace) => Packet.LazyPacket.TileEntityPlace(tileEntityPlace)
    | ItemDropModify(itemDropModify) => Packet.LazyPacket.ItemDropModify(itemDropModify)
    | ItemFramePlace(itemFramePlace) => Packet.LazyPacket.ItemFramePlace(itemFramePlace)
    | ItemDropInstancedUpdate(itemDropInstancedUpdate) =>
      Packet.LazyPacket.ItemDropInstancedUpdate(itemDropInstancedUpdate)
    | EmoteBubble(emoteBubble) => Packet.LazyPacket.EmoteBubble(emoteBubble)
    | ExtraValueSync(extraValueSync) => Packet.LazyPacket.ExtraValueSync(extraValueSync)
    | SocialHandshake(socialHandshake) => Packet.LazyPacket.SocialHandshake(socialHandshake)
    | Unused(unused) => Packet.LazyPacket.Unused(unused)
    | PortalKill(portalKill) => Packet.LazyPacket.PortalKill(portalKill)
    | PlayerTeleportPortal(playerTeleportPortal) =>
      Packet.LazyPacket.PlayerTeleportPortal(playerTeleportPortal)
    | NpcKilledNotification(npcKilledNotification) =>
      Packet.LazyPacket.NpcKilledNotification(npcKilledNotification)
    | EventNotification(eventNotification) => Packet.LazyPacket.EventNotification(eventNotification)
    | MinionTargetUpdate(minionTargetUpdate) =>
      Packet.LazyPacket.MinionTargetUpdate(minionTargetUpdate)
    | NpcTeleportPortal(npcTeleportPortal) => Packet.LazyPacket.NpcTeleportPortal(npcTeleportPortal)
    | ShieldStrengthsUpdate(shieldStrengthsUpdate) =>
      Packet.LazyPacket.ShieldStrengthsUpdate(shieldStrengthsUpdate)
    | NebulaLevelUp(nebulaLevelUp) => Packet.LazyPacket.NebulaLevelUp(nebulaLevelUp)
    | MoonLordCountdown(moonLordCountdown) =>
      Packet.LazyPacket.MoonLordCountdown(
        Lazy.make(() =>
          moonLordCountdown
          ->Lazy.get
          ->Result.map(MoonLordCountdown.toLatest)
        ),
      )
    | NpcShopItem(npcShopItem) => Packet.LazyPacket.NpcShopItem(npcShopItem)
    | GemLockToggle(gemLockToggle) => Packet.LazyPacket.GemLockToggle(gemLockToggle)
    | SmokePoof(smokePoof) => Packet.LazyPacket.SmokePoof(smokePoof)
    | ChatMessageSmart(chatMessageSmart) => Packet.LazyPacket.ChatMessageSmart(chatMessageSmart)
    | WiredCannonShot(wiredCannonShot) => Packet.LazyPacket.WiredCannonShot(wiredCannonShot)
    | MassWireOperation(massWireOperation) => Packet.LazyPacket.MassWireOperation(massWireOperation)
    | MassWireOperationPay(massWireOperationPay) =>
      Packet.LazyPacket.MassWireOperationPay(massWireOperationPay)
    | PartyToggle(partyToggle) => Packet.LazyPacket.PartyToggle(partyToggle)
    | TreeGrowFx(treeGrowFx) => Packet.LazyPacket.TreeGrowFx(treeGrowFx)
    | CrystalInvasionStart(crystalInvasionStart) =>
      Packet.LazyPacket.CrystalInvasionStart(crystalInvasionStart)
    | CrystalInvasionWipeAll(crystalInvasionWipeAll) =>
      Packet.LazyPacket.CrystalInvasionWipeAll(crystalInvasionWipeAll)
    | MinionAttackTargetUpdate(minionAttackTargetUpdate) =>
      Packet.LazyPacket.MinionAttackTargetUpdate(minionAttackTargetUpdate)
    | CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime) =>
      Packet.LazyPacket.CrystalInvasionSendWaitTime(crystalInvasionSendWaitTime)
    | PlayerDamage(playerDamage) => Packet.LazyPacket.PlayerDamage(playerDamage)
    | PlayerDeath(playerDeath) => Packet.LazyPacket.PlayerDeath(playerDeath)
    | CombatTextCreate(combatTextCreate) => Packet.LazyPacket.CombatTextCreate(combatTextCreate)
    | Emoji(emoji) => Packet.LazyPacket.Emoji(emoji)
    | TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync) =>
      Packet.LazyPacket.TileEntityDisplayDollItemSync(tileEntityDisplayDollItemSync)
    | TileEntityInteractionRequest(tileEntityInteractionRequest) =>
      Packet.LazyPacket.TileEntityInteractionRequest(tileEntityInteractionRequest)
    | WeaponsRackTryPlacing(weaponsRackTryPlacing) =>
      Packet.LazyPacket.WeaponsRackTryPlacing(weaponsRackTryPlacing)
    | TileEntityHatRackItemSync(tileEntityHatRackItemSync) =>
      Packet.LazyPacket.TileEntityHatRackItemSync(tileEntityHatRackItemSync)
    | TilePickingSync(tilePickingSync) => Packet.LazyPacket.TilePickingSync(tilePickingSync)
    | RevengeMarkerSync(revengeMarkerSync) => Packet.LazyPacket.RevengeMarkerSync(revengeMarkerSync)
    | RevengeMarkerRemove(revengeMarkerRemove) =>
      Packet.LazyPacket.RevengeMarkerRemove(revengeMarkerRemove)
    | GolfBallLandInCup(golfBallLandInCup) => Packet.LazyPacket.GolfBallLandInCup(golfBallLandInCup)
    | ClientFinishConnectingToServer(clientFinishConnectingToServer) =>
      Packet.LazyPacket.ClientFinishConnectingToServer(clientFinishConnectingToServer)
    | NpcFishOut(npcFishOut) => Packet.LazyPacket.NpcFishOut(npcFishOut)
    | NpcTamper(npcTamper) => Packet.LazyPacket.NpcTamper(npcTamper)
    | LegacySoundPlay(legacySoundPlay) => Packet.LazyPacket.LegacySoundPlay(legacySoundPlay)
    | FoodPlatterTryPlacing(foodPlatterTryPlacing) =>
      Packet.LazyPacket.FoodPlatterTryPlacing(foodPlatterTryPlacing)
    | PlayerLuckFactorsUpdate(playerLuckFactorsUpdate) =>
      Packet.LazyPacket.PlayerLuckFactorsUpdate(
        Lazy.make(() =>
          playerLuckFactorsUpdate->Lazy.get->Result.map(PlayerLuckFactorsUpdate.toLatest)
        ),
      )
    | PlayerDead(playerDead) => Packet.LazyPacket.PlayerDead(playerDead)
    | CavernMonsterTypeSync(cavernMonsterTypeSync) =>
      Packet.LazyPacket.CavernMonsterTypeSync(cavernMonsterTypeSync)
    | NpcBuffRemovalRequest(npcBuffRemovalRequest) =>
      Packet.LazyPacket.NpcBuffRemovalRequest(npcBuffRemovalRequest)
    | ClientSyncedInventory(clientSyncedInventory) =>
      Packet.LazyPacket.ClientSyncedInventory(clientSyncedInventory)
    | CountsAsHostForGameplaySet(countsAsHostForGameplaySet) =>
      Packet.LazyPacket.CountsAsHostForGameplaySet(countsAsHostForGameplaySet)
    }
  }
}

let toBuffer = (packet: t, _fromServer: bool): ISerializer.toBufferResult => {
  switch packet {
  | ConnectRequest(connectRequest) =>
    ConnectRequest.toBuffer(connectRequest)->ISerializer.toBufferResult
  | Disconnect(disconnect) => Disconnect.toBuffer(disconnect)->ISerializer.toBufferResult
  | PlayerSlotSet(playerSlotSet) =>
    PlayerSlotSet.toBuffer(playerSlotSet)->ISerializer.toBufferResult
  | PlayerInfo(playerInfo) => PlayerInfo.toBuffer(playerInfo)->ISerializer.toBufferResult
  | PlayerInventorySlot(playerInventorySlot) =>
    PlayerInventorySlot.toBuffer(playerInventorySlot)->ISerializer.toBufferResult
  | WorldDataRequest(worldDataRequest) =>
    WorldDataRequest.toBuffer(worldDataRequest)->ISerializer.toBufferResult
  | WorldInfo(worldInfo) => WorldInfo.toBuffer(worldInfo)->ISerializer.toBufferResult
  | InitialTileSectionsRequest(initialTileSectionsRequest) =>
    InitialTileSectionsRequest.toBuffer(initialTileSectionsRequest)->ISerializer.toBufferResult
  | Status(status) => Status.toBuffer(status)->ISerializer.toBufferResult
  | TileSectionSend(_tileSectionSend) => NotImplemented
  | TileSectionFrame(_tileSectionFrame) => NotImplemented
  | PlayerSpawn(playerSpawn) => PlayerSpawn.toBuffer(playerSpawn)->ISerializer.toBufferResult
  | PlayerUpdate(_playerUpdate) => NotImplemented
  | PlayerActive(playerActive) => PlayerActive.toBuffer(playerActive)->ISerializer.toBufferResult
  | PlayerHealth(playerHealth) => PlayerHealth.toBuffer(playerHealth)->ISerializer.toBufferResult
  | TileModify(_tileModify) => NotImplemented
  | TimeSet(_timeSet) => NotImplemented
  | DoorUse(_doorUse) => NotImplemented
  | TileSquareSend(tileSquareSend) =>
    TileSquareSend.toBuffer(tileSquareSend)->ISerializer.toBufferResult
  | ItemDropUpdate(itemDropUpdate) =>
    ItemDropUpdate.toBuffer(itemDropUpdate)->ISerializer.toBufferResult
  | ItemOwner(_itemOwner) => NotImplemented
  | NpcUpdate(npcUpdate) => NpcUpdate.toBuffer(npcUpdate)->ISerializer.toBufferResult
  | NpcItemStrike(_npcItemStrike) => NotImplemented
  | ProjectileSync(projectileSync) =>
    ProjectileSync.toBuffer(projectileSync)->ISerializer.toBufferResult
  | NpcStrike(_npcStrike) => NotImplemented
  | ProjectileDestroy(projectileDestroy) =>
    ProjectileDestroy.toBuffer(projectileDestroy)->ISerializer.toBufferResult
  | PvpToggle(_pvpToggle) => NotImplemented
  | ChestOpen(_chestOpen) => NotImplemented
  | ChestItem(_chestItem) => NotImplemented
  | ActiveContainerSync(_activeContainerSync) => NotImplemented
  | ChestPlace(_chestPlace) => NotImplemented
  | HealEffect(_healEffect) => NotImplemented
  | Zones(_zones) => NotImplemented
  | PasswordRequired(_passwordRequired) => NotImplemented
  | PasswordSend(_passwordSend) => NotImplemented
  | ItemOwnerRemove(_itemOwnerRemove) => NotImplemented
  | NpcTalk(_npcTalk) => NotImplemented
  | PlayerAnimation(_playerAnimation) => NotImplemented
  | PlayerMana(playerMana) => PlayerMana.toBuffer(playerMana)->ISerializer.toBufferResult
  | ManaEffect(_manaEffect) => NotImplemented
  | PlayerTeam(_playerTeam) => NotImplemented
  | SignRead(_signRead) => NotImplemented
  | SignNew(_signNew) => NotImplemented
  | LiquidSet(_liquidSet) => NotImplemented
  | PlayerSpawnSelf(_playerSpawnSelf) => NotImplemented
  | PlayerBuffsSet(_playerBuffsSet) => NotImplemented
  | NpcSpecialEffect(_npcSpecialEffect) => NotImplemented
  | ChestOrTempleUnlock(_chestOrTempleUnlock) => NotImplemented
  | NpcBuffAdd(_npcBuffAdd) => NotImplemented
  | NpcBuffUpdate(_npcBuffUpdate) => NotImplemented
  | PlayerBuffAdd(_playerBuffAdd) => NotImplemented
  | NpcNameUpdate(_npcNameUpdate) => NotImplemented
  | GoodEvilUpdate(_goodEvilUpdate) => NotImplemented
  | HarpPlay(_harpPlay) => NotImplemented
  | SwitchHit(_switchHit) => NotImplemented
  | NpcHomeUpdate(_npcHomeUpdate) => NotImplemented
  | BossOrInvasionSpawn(_bossOrInvasionSpawn) => NotImplemented
  | PlayerDodge(_playerDodge) => NotImplemented
  | TilePaint(_tilePaint) => NotImplemented
  | WallPaint(_wallPaint) => NotImplemented
  | Teleport(_teleport) => NotImplemented
  | PlayerHealOther(_playerHealOther) => NotImplemented
  | DimensionsUpdate(dimensionsUpdate) =>
    DimensionsUpdate.toBuffer(dimensionsUpdate)->ISerializer.toBufferResult
  | ClientUuid(_clientUuid) => NotImplemented
  | ChestName(_chestName) => NotImplemented
  | NpcCatch(_catchNpc) => NotImplemented
  | NpcRelease(_releaseNpc) => NotImplemented
  | TravellingMerchantInventory(_travellingMerchantInventory) => NotImplemented
  | TeleportationPotion(_teleportationPotion) => NotImplemented
  | AnglerQuest(_anglerQuest) => NotImplemented
  | AnglerQuestComplete(_anglerQuestComplete) => NotImplemented
  | AnglerQuestsCompletedAmount(_anglerQuestsCompletedAmount) => NotImplemented
  | TemporaryAnimationCreate(_temporaryAnimationCreate) => NotImplemented
  | InvasionProgressReport(_invasionProgressReport) => NotImplemented
  | ObjectPlace(_objectPlace) => NotImplemented
  | PlayerChestIndexSync(_playerChestIndexSync) => NotImplemented
  | CombatNumberCreate(_combatNumberCreate) => NotImplemented
  | NetModuleLoad(netModuleLoad) =>
    NetModuleLoad.toBuffer(netModuleLoad)->ISerializer.toBufferResult
  | NpcKillCount(_npcKillCount) => NotImplemented
  | PlayerStealth(_playerStealth) => NotImplemented
  | ItemForceIntoNearestChest(_itemForceIntoNearestChest) => NotImplemented
  | TileEntityUpdate(_tileEntityUpdate) => NotImplemented
  | TileEntityPlace(_tileEntityPlace) => NotImplemented
  | ItemDropModify(_itemDropModify) => NotImplemented
  | ItemFramePlace(_itemFramePlace) => NotImplemented
  | ItemDropInstancedUpdate(_itemDropInstancedUpdate) => NotImplemented
  | EmoteBubble(_emoteBubble) => NotImplemented
  | ExtraValueSync(_extraValueSync) => NotImplemented
  | SocialHandshake(_socialHandshake) => NotImplemented
  | Unused(_unused) => NotImplemented
  | PortalKill(_portalKill) => NotImplemented
  | PlayerTeleportPortal(_playerTeleportPortal) => NotImplemented
  | NpcKilledNotification(_npcKilledNotification) => NotImplemented
  | EventNotification(_eventNotification) => NotImplemented
  | MinionTargetUpdate(_minionTargetUpdate) => NotImplemented
  | NpcTeleportPortal(_npcTeleportPortal) => NotImplemented
  | ShieldStrengthsUpdate(_shieldStrengthsUpdate) => NotImplemented
  | NebulaLevelUp(_nebulaLevelUp) => NotImplemented
  | MoonLordCountdown(_moonLordCountdown) => NotImplemented
  | NpcShopItem(_npcShopItem) => NotImplemented
  | GemLockToggle(_gemLockToggle) => NotImplemented
  | SmokePoof(_smokePoof) => NotImplemented
  | ChatMessageSmart(_chatMessageSmart) => NotImplemented
  | WiredCannonShot(_wiredCannonShot) => NotImplemented
  | MassWireOperation(_massWireOperation) => NotImplemented
  | MassWireOperationPay(_massWireOperationPay) => NotImplemented
  | PartyToggle(_partyToggle) => NotImplemented
  | TreeGrowFx(_treeGrowFx) => NotImplemented
  | CrystalInvasionStart(_crystalInvasionStart) => NotImplemented
  | CrystalInvasionWipeAll(_crystalInvasionWipeAll) => NotImplemented
  | MinionAttackTargetUpdate(_minionAttackTargetUpdate) => NotImplemented
  | CrystalInvasionSendWaitTime(_crystalInvasionSendWaitTime) => NotImplemented
  | PlayerDamage(_playerDamage) => NotImplemented
  | PlayerDeath(_playerDeath) => NotImplemented
  | CombatTextCreate(_combatTextCreate) => NotImplemented
  | Emoji(_emoji) => NotImplemented
  | TileEntityDisplayDollItemSync(_tileEntityDisplayDollItemSync) => NotImplemented
  | TileEntityInteractionRequest(_tileEntityInteractionRequest) => NotImplemented
  | WeaponsRackTryPlacing(_weaponsRackTryPlacing) => NotImplemented
  | TileEntityHatRackItemSync(_tileEntityHatRackItemSync) => NotImplemented
  | TilePickingSync(_tilePickingSync) => NotImplemented
  | RevengeMarkerSync(_revengeMarkerSync) => NotImplemented
  | RevengeMarkerRemove(_revengeMarkerRemove) => NotImplemented
  | GolfBallLandInCup(_golfBallLandInCup) => NotImplemented
  | ClientFinishConnectingToServer(_clientFinishConnectingToServer) => NotImplemented
  | NpcFishOut(_npcFishOut) => NotImplemented
  | NpcTamper(_npcTamper) => NotImplemented
  | LegacySoundPlay(_legacySoundPlay) => NotImplemented
  | FoodPlatterTryPlacing(_foodPlatterTryPlacing) => NotImplemented
  | PlayerLuckFactorsUpdate(_playerLuckFactorsUpdate) => NotImplemented
  | PlayerDead(_playerDead) => NotImplemented
  | CavernMonsterTypeSync(_cavernMonsterTypeSync) => NotImplemented
  | NpcBuffRemovalRequest(_npcBuffRemovalRequest) => NotImplemented
  | ClientSyncedInventory(_clientSyncedInventory) => NotImplemented
  | CountsAsHostForGameplaySet(_countsAsHostForGameplaySet) => NotImplemented
  }
}

let serialize: ISerializer.serialize<t> = (~parsed: IParser.parsed<t>, ~fromServer: bool) =>
  switch parsed {
  | IParser.ShouldSerialize(packet) => toBuffer(packet, fromServer)
  | IParser.SerializeNotNecessary(_, buffer) => Ok(buffer)
  }

let serializeFromLatest: ISerializer.serialize<Packet.t> = (
  ~parsed: IParser.parsed<Packet.t>,
  ~fromServer: bool,
) =>
  switch parsed {
  | IParser.ShouldSerialize(packet) =>
    switch fromLatest(packet, fromServer) {
    | Some(Same(packet))
    | Some(NotSame(packet)) =>
      toBuffer(packet, fromServer)
    | None => NotImplemented
    }
  | IParser.SerializeNotNecessary(packet, buffer) =>
    switch fromLatest(packet, fromServer) {
    | Some(Same(_packet)) => Ok(buffer)
    | Some(NotSame(packet)) => toBuffer(packet, fromServer)
    | None => NotImplemented
    }
  }
