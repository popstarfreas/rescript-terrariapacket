// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Belt_Option = require("@rescript/runtime/lib/js/Belt_Option.js");
let Primitive_option = require("@rescript/runtime/lib/js/Primitive_option.js");
let BitFlags$TerrariaPacket = require("../BitFlags.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function parse(payload) {
  let reader = new Packetreader(payload);
  let projectileId = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileId");
  let x = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "x");
  let y = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "y");
  let vx = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vx");
  let vy = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vy");
  let owner = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "owner");
  let projectileType = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileType");
  let flags = BitFlags$TerrariaPacket.fromByte(ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "flags"));
  let flags2 = BitFlags$TerrariaPacket.flag3(flags) ? Primitive_option.some(BitFlags$TerrariaPacket.fromByte(ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "flags2"))) : undefined;
  let ai0 = BitFlags$TerrariaPacket.flag1(flags) ? ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai0") : undefined;
  let ai1 = BitFlags$TerrariaPacket.flag2(flags) ? ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai1") : undefined;
  let bannerIdToRespondTo = BitFlags$TerrariaPacket.flag4(flags) ? ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "bannerIdToRespondTo") : undefined;
  let damage = BitFlags$TerrariaPacket.flag5(flags) ? ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "damage") : undefined;
  let knockback = BitFlags$TerrariaPacket.flag6(flags) ? ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "knockback") : undefined;
  let originalDamage = BitFlags$TerrariaPacket.flag7(flags) ? ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "originalDamage") : undefined;
  let projectileUuid = BitFlags$TerrariaPacket.flag8(flags) ? ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileUuid") : undefined;
  let ai2 = flags2 !== undefined && BitFlags$TerrariaPacket.flag1(Primitive_option.valFromOption(flags2)) ? ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai2") : undefined;
  return {
    projectileId: projectileId,
    x: x,
    y: y,
    vx: vx,
    vy: vy,
    owner: owner,
    projectileType: projectileType,
    ai: [
      ai0,
      ai1,
      ai2
    ],
    bannerIdToRespondTo: bannerIdToRespondTo,
    damage: damage,
    knockback: knockback,
    originalDamage: originalDamage,
    projectileUuid: projectileUuid
  };
}

function packOptionalData(writer, self) {
  let match = self.ai;
  let ai2 = match[2];
  let ai1 = match[1];
  let ai0 = match[0];
  let bitFlags2 = BitFlags$TerrariaPacket.fromFlags(Belt_Option.isSome(ai2), false, false, false, false, false, false, false);
  let bannerIdToRespondTo = self.bannerIdToRespondTo;
  let bitFlags = BitFlags$TerrariaPacket.fromFlags(Belt_Option.isSome(ai0), Belt_Option.isSome(ai1), BitFlags$TerrariaPacket.toByte(bitFlags2) !== 0, bannerIdToRespondTo !== undefined ? bannerIdToRespondTo !== 0 : false, Belt_Option.isSome(self.damage), Belt_Option.isSome(self.knockback), Belt_Option.isSome(self.originalDamage), Belt_Option.isSome(self.projectileUuid));
  ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(bitFlags), "flags");
  if (BitFlags$TerrariaPacket.flag3(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(bitFlags2), "flags2");
  }
  if (BitFlags$TerrariaPacket.flag1(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai0, "ai0");
  }
  if (BitFlags$TerrariaPacket.flag2(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai1, "ai1");
  }
  if (BitFlags$TerrariaPacket.flag4(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer, self.bannerIdToRespondTo, "bannerIdToRespondTo");
  }
  if (BitFlags$TerrariaPacket.flag5(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.damage, "damage");
  }
  if (BitFlags$TerrariaPacket.flag6(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, self.knockback, "knockback");
  }
  if (BitFlags$TerrariaPacket.flag7(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.originalDamage, "originalDamage");
  }
  if (BitFlags$TerrariaPacket.flag8(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.projectileUuid, "projectileUuid");
  }
  if (BitFlags$TerrariaPacket.flag1(bitFlags2)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai2, "ai2");
  }
  return writer;
}

function toBuffer(self) {
  return ErrorAwarePacketWriter$TerrariaPacket.data(packOptionalData(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("ProjectileSync")), self.projectileId, "projectileId"), self.x, "x"), self.y, "y"), self.vx, "vx"), self.vy, "vy"), self.owner, "owner"), self.projectileType, "projectileType"), self));
}

exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
