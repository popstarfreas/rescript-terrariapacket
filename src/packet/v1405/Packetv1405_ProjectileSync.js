// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Belt_Option = require("@rescript/runtime/lib/js/Belt_Option.js");
let Stdlib_Result = require("@rescript/runtime/lib/js/Stdlib_Result.js");
let BitFlags$TerrariaPacket = require("../../BitFlags.js");
let PacketType$TerrariaPacket = require("../../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function parse(payload) {
  let reader = new Packetreader(payload);
  let e = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileId");
  if (e.TAG !== "Ok") {
    return e;
  }
  let e$1 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "x");
  if (e$1.TAG !== "Ok") {
    return e$1;
  }
  let e$2 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "y");
  if (e$2.TAG !== "Ok") {
    return e$2;
  }
  let e$3 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vx");
  if (e$3.TAG !== "Ok") {
    return e$3;
  }
  let e$4 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vy");
  if (e$4.TAG !== "Ok") {
    return e$4;
  }
  let e$5 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "owner");
  if (e$5.TAG !== "Ok") {
    return e$5;
  }
  let e$6 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileType");
  if (e$6.TAG !== "Ok") {
    return e$6;
  }
  let e$7 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "flags");
  if (e$7.TAG !== "Ok") {
    return e$7;
  }
  let flags = BitFlags$TerrariaPacket.fromByte(e$7._0);
  let e$8 = BitFlags$TerrariaPacket.flag1(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai0"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$8.TAG !== "Ok") {
    return e$8;
  }
  let e$9 = BitFlags$TerrariaPacket.flag2(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai1"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$9.TAG !== "Ok") {
    return e$9;
  }
  let e$10 = BitFlags$TerrariaPacket.flag5(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "damage"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$10.TAG !== "Ok") {
    return e$10;
  }
  let e$11 = BitFlags$TerrariaPacket.flag6(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "knockback"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$11.TAG !== "Ok") {
    return e$11;
  }
  let e$12 = BitFlags$TerrariaPacket.flag7(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "originalDamage"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$12.TAG !== "Ok") {
    return e$12;
  }
  let e$13 = BitFlags$TerrariaPacket.flag8(flags) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "projectileUuid"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (e$13.TAG === "Ok") {
    return {
      TAG: "Ok",
      _0: {
        projectileId: e._0,
        x: e$1._0,
        y: e$2._0,
        vx: e$3._0,
        vy: e$4._0,
        owner: e$5._0,
        projectileType: e$6._0,
        ai: [
          e$8._0,
          e$9._0,
          undefined
        ],
        bannerIdToRespondTo: undefined,
        damage: e$10._0,
        knockback: e$11._0,
        originalDamage: e$12._0,
        projectileUuid: e$13._0
      }
    };
  } else {
    return e$13;
  }
}

let Decode = {
  readSingle: ErrorAwarePacketReader$TerrariaPacket.readSingle,
  readInt16: ErrorAwarePacketReader$TerrariaPacket.readInt16,
  readByte: ErrorAwarePacketReader$TerrariaPacket.readByte,
  parse: parse
};

function packOptionalData(writer, self) {
  let match = self.ai;
  let ai1 = match[1];
  let ai0 = match[0];
  let bitFlags = BitFlags$TerrariaPacket.fromFlags(Belt_Option.isSome(ai0), Belt_Option.isSome(ai1), false, false, Belt_Option.isSome(self.damage), Belt_Option.isSome(self.knockback), Belt_Option.isSome(self.originalDamage), Belt_Option.isSome(self.projectileUuid));
  ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(bitFlags), "flags");
  if (BitFlags$TerrariaPacket.flag1(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai0, "ai0");
  }
  if (BitFlags$TerrariaPacket.flag2(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai1, "ai1");
  }
  if (BitFlags$TerrariaPacket.flag5(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.damage, "damage");
  }
  if (BitFlags$TerrariaPacket.flag6(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, self.knockback, "knockback");
  }
  if (BitFlags$TerrariaPacket.flag7(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.originalDamage, "originalDamage");
  }
  if (BitFlags$TerrariaPacket.flag8(bitFlags)) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, self.projectileUuid, "projectileUuid");
  }
  return writer;
}

function toBuffer(self) {
  let id = self.projectileId;
  return ErrorAwarePacketWriter$TerrariaPacket.data(packOptionalData(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("ProjectileSync")), id === 954 ? 504 : (
      id === 955 ? 12 : id
    ), "projectileId"), self.x, "x"), self.y, "y"), self.vx, "vx"), self.vy, "vy"), self.owner, "owner"), self.projectileType, "projectileType"), self));
}

let Encode = {
  packSingle: ErrorAwarePacketWriter$TerrariaPacket.packSingle,
  packInt16: ErrorAwarePacketWriter$TerrariaPacket.packInt16,
  packByte: ErrorAwarePacketWriter$TerrariaPacket.packByte,
  setType: ErrorAwarePacketWriter$TerrariaPacket.setType,
  data: ErrorAwarePacketWriter$TerrariaPacket.data,
  packOptionalData: packOptionalData,
  starCannonStarProjectileId: 955,
  fallenStarProjectileId: 12,
  wandOfSparkingSparkProjectileId: 954,
  sparkProjectileId: 504,
  toBuffer: toBuffer
};

exports.Decode = Decode;
exports.Encode = Encode;
exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
