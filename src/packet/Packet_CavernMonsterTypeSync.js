// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Stdlib_Array = require("@rescript/runtime/lib/js/Stdlib_Array.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function parse(payload) {
  let reader = new Packetreader(payload);
  let rows = Stdlib_Array.make(2, []);
  let error;
  for (let i = 0; i <= 1; ++i) {
    if (error !== undefined) {
      let row = Stdlib_Array.make(3, 0);
      for (let j = 0; j <= 2; ++j) {
        if (error !== undefined) {
          let value = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, `monster_` + i.toString() + `_` + j.toString());
          if (value.TAG === "Ok") {
            row[j] = value._0;
          } else {
            error = value._0;
          }
        }
      }
      rows[i] = row;
    }
  }
  let err = error;
  if (err !== undefined) {
    return {
      TAG: "Error",
      _0: err
    };
  } else {
    return {
      TAG: "Ok",
      _0: rows
    };
  }
}

let Decode = {
  readUInt16: ErrorAwarePacketReader$TerrariaPacket.readUInt16,
  parse: parse
};

function packRow(writer, row, rowIdx) {
  let _writer = writer;
  let _colIdx = 0;
  while (true) {
    let colIdx = _colIdx;
    let writer$1 = _writer;
    if (colIdx >= row.length) {
      return writer$1;
    }
    _colIdx = colIdx + 1 | 0;
    _writer = ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer$1, row[colIdx], `monster_` + rowIdx.toString() + `_` + colIdx.toString());
    continue;
  };
}

function packRows(writer, rows) {
  let _writer = writer;
  let _rowIdx = 0;
  while (true) {
    let rowIdx = _rowIdx;
    let writer$1 = _writer;
    if (rowIdx >= rows.length) {
      return writer$1;
    }
    _rowIdx = rowIdx + 1 | 0;
    _writer = packRow(writer$1, rows[rowIdx], rowIdx);
    continue;
  };
}

function toBuffer(self) {
  if (self.length !== 2 || self[0].length !== 3 || self[1].length !== 3) {
    return {
      TAG: "Error",
      _0: {
        context: "Packet_CavernMonsterTypeSync.toBuffer",
        error: new Error("Expected a 2x3 array of monster types")
      }
    };
  } else {
    return ErrorAwarePacketWriter$TerrariaPacket.data(packRows(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("CavernMonsterTypeSync")), self));
  }
}

let Encode = {
  packUInt16: ErrorAwarePacketWriter$TerrariaPacket.packUInt16,
  setType: ErrorAwarePacketWriter$TerrariaPacket.setType,
  data: ErrorAwarePacketWriter$TerrariaPacket.data,
  packRow: packRow,
  packRows: packRows,
  toBuffer: toBuffer
};

exports.Decode = Decode;
exports.Encode = Encode;
exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
