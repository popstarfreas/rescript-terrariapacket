// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Stdlib_Option = require("@rescript/runtime/lib/js/Stdlib_Option.js");
let Stdlib_Result = require("@rescript/runtime/lib/js/Stdlib_Result.js");
let BitFlags$TerrariaPacket = require("../BitFlags.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function parseFlags2(reader, flags2) {
  let width = BitFlags$TerrariaPacket.flag1(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "width"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (width.TAG !== "Ok") {
    return width;
  }
  let height = BitFlags$TerrariaPacket.flag2(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "height"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (height.TAG !== "Ok") {
    return height;
  }
  let scale = BitFlags$TerrariaPacket.flag3(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "scale"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (scale.TAG !== "Ok") {
    return scale;
  }
  let ammo = BitFlags$TerrariaPacket.flag4(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "ammo"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (ammo.TAG !== "Ok") {
    return ammo;
  }
  let useAmmo = BitFlags$TerrariaPacket.flag5(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "useAmmo"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (useAmmo.TAG !== "Ok") {
    return useAmmo;
  }
  let notAmmo = BitFlags$TerrariaPacket.flag6(flags2) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "notAmmo"), v => v === 1) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (notAmmo.TAG === "Ok") {
    return {
      TAG: "Ok",
      _0: [
        width._0,
        height._0,
        scale._0,
        ammo._0,
        useAmmo._0,
        notAmmo._0
      ]
    };
  } else {
    return notAmmo;
  }
}

function parse(payload) {
  let reader = new Packetreader(payload);
  let e = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "itemId");
  if (e.TAG !== "Ok") {
    return e;
  }
  let e$1 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "flags1");
  if (e$1.TAG !== "Ok") {
    return e$1;
  }
  let flags1 = BitFlags$TerrariaPacket.fromByte(e$1._0);
  let color;
  if (BitFlags$TerrariaPacket.flag1(flags1)) {
    let e$2 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "Color.r");
    if (e$2.TAG === "Ok") {
      let e$3 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "Color.g");
      if (e$3.TAG === "Ok") {
        let e$4 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "Color.b");
        if (e$4.TAG === "Ok") {
          let e$5 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "Color.a");
          color = e$5.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                r: e$2._0,
                g: e$3._0,
                b: e$4._0,
                a: e$5._0
              }
            }) : e$5;
        } else {
          color = e$4;
        }
      } else {
        color = e$3;
      }
    } else {
      color = e$2;
    }
  } else {
    color = {
      TAG: "Ok",
      _0: undefined
    };
  }
  if (color.TAG !== "Ok") {
    return color;
  }
  let damage = BitFlags$TerrariaPacket.flag2(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "damage"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (damage.TAG !== "Ok") {
    return damage;
  }
  let knockback = BitFlags$TerrariaPacket.flag3(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "knockback"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (knockback.TAG !== "Ok") {
    return knockback;
  }
  let useAnimation = BitFlags$TerrariaPacket.flag4(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "useAnimation"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (useAnimation.TAG !== "Ok") {
    return useAnimation;
  }
  let useTime = BitFlags$TerrariaPacket.flag5(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "useTime"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (useTime.TAG !== "Ok") {
    return useTime;
  }
  let shoot = BitFlags$TerrariaPacket.flag6(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "shoot"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (shoot.TAG !== "Ok") {
    return shoot;
  }
  let shootSpeed = BitFlags$TerrariaPacket.flag7(flags1) ? Stdlib_Result.map(ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "shootSpeed"), v => v) : ({
      TAG: "Ok",
      _0: undefined
    });
  if (shootSpeed.TAG !== "Ok") {
    return shootSpeed;
  }
  let e$6;
  if (BitFlags$TerrariaPacket.flag8(flags1)) {
    let e$7 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "flags2");
    e$6 = e$7.TAG === "Ok" ? parseFlags2(reader, BitFlags$TerrariaPacket.fromByte(e$7._0)) : e$7;
  } else {
    e$6 = {
      TAG: "Ok",
      _0: [
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined
      ]
    };
  }
  if (e$6.TAG !== "Ok") {
    return e$6;
  }
  let match = e$6._0;
  return {
    TAG: "Ok",
    _0: {
      itemId: e._0,
      color: color._0,
      damage: damage._0,
      knockback: knockback._0,
      useAnimation: useAnimation._0,
      useTime: useTime._0,
      shoot: shoot._0,
      shootSpeed: shootSpeed._0,
      width: match[0],
      height: match[1],
      scale: match[2],
      ammo: match[3],
      useAmmo: match[4],
      notAmmo: match[5]
    }
  };
}

let Decode = {
  readInt16: ErrorAwarePacketReader$TerrariaPacket.readInt16,
  readByte: ErrorAwarePacketReader$TerrariaPacket.readByte,
  readUInt32: ErrorAwarePacketReader$TerrariaPacket.readUInt32,
  readUInt16: ErrorAwarePacketReader$TerrariaPacket.readUInt16,
  readSingle: ErrorAwarePacketReader$TerrariaPacket.readSingle,
  parseFlags2: parseFlags2,
  parse: parse
};

function flags1(self) {
  return BitFlags$TerrariaPacket.fromFlags(Stdlib_Option.isSome(self.color), Stdlib_Option.isSome(self.damage), Stdlib_Option.isSome(self.knockback), Stdlib_Option.isSome(self.useAnimation), Stdlib_Option.isSome(self.useTime), Stdlib_Option.isSome(self.shoot), Stdlib_Option.isSome(self.shootSpeed), Stdlib_Option.isSome(self.width) || Stdlib_Option.isSome(self.height) || Stdlib_Option.isSome(self.scale) || Stdlib_Option.isSome(self.ammo) || Stdlib_Option.isSome(self.useAmmo) || Stdlib_Option.isSome(self.notAmmo));
}

function flags2(self) {
  return BitFlags$TerrariaPacket.fromFlags(Stdlib_Option.isSome(self.width), Stdlib_Option.isSome(self.height), Stdlib_Option.isSome(self.scale), Stdlib_Option.isSome(self.ammo), Stdlib_Option.isSome(self.useAmmo), Stdlib_Option.isSome(self.notAmmo), false, false);
}

function toBuffer(self) {
  let writer = ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("ItemDropModify")), self.itemId, "itemId"), BitFlags$TerrariaPacket.toByte(flags1(self)), "flags1");
  let c = self.color;
  if (c !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, c.r, "Color.r");
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, c.g, "Color.g");
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, c.b, "Color.b");
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, c.a, "Color.a");
  }
  let v = self.damage;
  if (v !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer, v, "damage");
  }
  let v$1 = self.knockback;
  if (v$1 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, v$1, "knockback");
  }
  let v$2 = self.useAnimation;
  if (v$2 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer, v$2, "useAnimation");
  }
  let v$3 = self.useTime;
  if (v$3 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer, v$3, "useTime");
  }
  let v$4 = self.shoot;
  if (v$4 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, v$4, "shoot");
  }
  let v$5 = self.shootSpeed;
  if (v$5 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, v$5, "shootSpeed");
  }
  if (BitFlags$TerrariaPacket.flag8(flags1(self))) {
    ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(flags2(self)), "flags2");
    let v$6 = self.width;
    if (v$6 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, v$6, "width");
    }
    let v$7 = self.height;
    if (v$7 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, v$7, "height");
    }
    let v$8 = self.scale;
    if (v$8 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, v$8, "scale");
    }
    let v$9 = self.ammo;
    if (v$9 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, v$9, "ammo");
    }
    let v$10 = self.useAmmo;
    if (v$10 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, v$10, "useAmmo");
    }
    let v$11 = self.notAmmo;
    if (v$11 !== undefined) {
      ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, v$11 ? 1 : 0, "notAmmo");
    }
  }
  return ErrorAwarePacketWriter$TerrariaPacket.data(writer);
}

let Encode = {
  packInt16: ErrorAwarePacketWriter$TerrariaPacket.packInt16,
  packByte: ErrorAwarePacketWriter$TerrariaPacket.packByte,
  packUInt32: ErrorAwarePacketWriter$TerrariaPacket.packUInt32,
  packUInt16: ErrorAwarePacketWriter$TerrariaPacket.packUInt16,
  packSingle: ErrorAwarePacketWriter$TerrariaPacket.packSingle,
  setType: ErrorAwarePacketWriter$TerrariaPacket.setType,
  data: ErrorAwarePacketWriter$TerrariaPacket.data,
  flags1: flags1,
  flags2: flags2,
  toBuffer: toBuffer
};

exports.Decode = Decode;
exports.Encode = Encode;
exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
