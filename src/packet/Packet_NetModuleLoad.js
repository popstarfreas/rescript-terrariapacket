// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Belt_Array = require("@rescript/runtime/lib/js/Belt_Array.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let CreativePowers$TerrariaPacket = require("../CreativePowers.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function makeError(_message) {
  return (new Error(_message));
}

function pylonActionToInt(pylonAction) {
  switch (pylonAction) {
    case "Added" :
      return 0;
    case "Removed" :
      return 1;
    case "RequestTeleport" :
      return 2;
  }
}

function powerLevelToInt(powerLevel) {
  switch (powerLevel) {
    case "LockedForEveryone" :
      return 0;
    case "CanBeChangedByHostAlone" :
      return 1;
    case "CanBeChangedByEveryone" :
      return 2;
  }
}

function fromInt(n) {
  switch (n) {
    case 0 :
      return "Liquid";
    case 1 :
      return "Text";
    case 2 :
      return "Ping";
    case 3 :
      return "Ambience";
    case 4 :
      return "Bestiary";
    case 5 :
      return "CreativeUnlocks";
    case 6 :
      return "CreativePower";
    case 7 :
      return "CreativeUnlocksPlayerReport";
    case 8 :
      return "TeleportPylon";
    case 9 :
      return "Particles";
    case 10 :
      return "CreativePowerPermissions";
    default:
      return;
  }
}

function toInt(self) {
  switch (self) {
    case "Liquid" :
      return 0;
    case "Text" :
      return 1;
    case "Ping" :
      return 2;
    case "Ambience" :
      return 3;
    case "Bestiary" :
      return 4;
    case "CreativeUnlocks" :
      return 5;
    case "CreativePower" :
      return 6;
    case "CreativeUnlocksPlayerReport" :
      return 7;
    case "TeleportPylon" :
      return 8;
    case "Particles" :
      return 9;
    case "CreativePowerPermissions" :
      return 10;
  }
}

let NetModuleType = {
  fromInt: fromInt,
  toInt: toInt
};

function toBuffer(self) {
  switch (self.TAG) {
    case "Liquid" :
      let liquid = self._0;
      let writer = ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 0, "moduleType"), liquid.changes.length, "changesCount");
      liquid.changes.forEach(change => {
        ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packInt16(writer, change.y, "y"), change.x, "x"), change.amount, "amount"), change.liquidType, "liquidType");
      });
      return ErrorAwarePacketWriter$TerrariaPacket.data(writer);
    case "ClientText" :
      let commandId = self._0;
      let message = self._1;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packString(ErrorAwarePacketWriter$TerrariaPacket.packString(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 1, "moduleType"), commandId, "commandId"), message, "message"));
    case "ServerText" :
      let playerId = self._0;
      let networkText = self._1;
      let color = self._2;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packColor(ErrorAwarePacketWriter$TerrariaPacket.packNetworkText(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 1, "moduleType"), playerId, "playerId"), networkText, "networkText"), color, "color"));
    case "Ping" :
      let ping = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 2, "moduleType"), ping.x, "x"), ping.y, "y"));
    case "Ambience" :
      let ambience = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packInt32(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 3, "moduleType"), ambience.playerId, "playerId"), ambience.seed, "seed"), ambience.skyEntityType, "skyEntityType"));
    case "Bestiary" :
      let bestiary = self._0;
      let writer$1 = ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 4, "moduleType");
      let _count = bestiary.unlockType;
      let tmp;
      tmp = typeof _count !== "object" ? (
          _count === "Sight" ? ErrorAwarePacketWriter$TerrariaPacket.packByte(writer$1, 1, "unlockTypeByte") : ErrorAwarePacketWriter$TerrariaPacket.packByte(writer$1, 2, "unlockTypeByte")
        ) : ErrorAwarePacketWriter$TerrariaPacket.packByte(writer$1, 0, "unlockTypeByte");
      ErrorAwarePacketWriter$TerrariaPacket.packInt16(tmp, bestiary.npcId, "npcId");
      let count = bestiary.unlockType;
      let tmp$1;
      tmp$1 = typeof count !== "object" ? writer$1 : ErrorAwarePacketWriter$TerrariaPacket.packUInt16(writer$1, count._0, "killCount");
      return ErrorAwarePacketWriter$TerrariaPacket.data(tmp$1);
    case "CreativeUnlocks" :
      let creativeUnlock = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 5, "moduleType"), creativeUnlock.itemId, "itemId"), creativeUnlock.researchedCount, "researchedCount"));
    case "CreativePower" :
      let creativePower = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(CreativePowers$TerrariaPacket.pack(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 6, "moduleType"), creativePower));
    case "CreativeUnlocksPlayerReport" :
      let unlockReport = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 7, "moduleType"), unlockReport.itemId, "itemId"), unlockReport.researchedCount, "researchedCount"));
    case "TeleportPylon" :
      let teleportPylon = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 8, "moduleType"), pylonActionToInt(teleportPylon.pylonAction), "pylonAction"), teleportPylon.x, "x"), teleportPylon.y, "y"), teleportPylon.pylonType, "pylonType"));
    case "Particles" :
      let particle = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packInt32(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 9, "moduleType"), particle.particleType, "particleType"), particle.x, "x"), particle.y, "y"), particle.vx, "vx"), particle.vy, "vy"), particle.shaderIndex, "shaderIndex"), particle.invokedByPlayer, "invokedByPlayer"));
    case "CreativePowerPermissions" :
      let creativePowerPermission = self._0;
      return ErrorAwarePacketWriter$TerrariaPacket.data(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NetModuleLoad")), 10, "moduleType"), creativePowerPermission.powerType, "powerType"), powerLevelToInt(creativePowerPermission.powerLevel), "powerLevel"));
  }
}

function parse(payload, fromServer) {
  let reader = new Packetreader(payload);
  let e = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "moduleType");
  if (e.TAG !== "Ok") {
    return e;
  }
  let match = fromInt(e._0);
  if (match === undefined) {
    return {
      TAG: "Error",
      _0: {
        context: "Packet_NetModuleLoad.parse",
        error: makeError("Unknown net module type")
      }
    };
  }
  switch (match) {
    case "Liquid" :
      let e$1 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "changesCount");
      if (e$1.TAG !== "Ok") {
        return e$1;
      }
      let changesCount = e$1._0;
      let readChanges = (_idx, _acc) => {
        while (true) {
          let acc = _acc;
          let idx = _idx;
          if (idx >= changesCount) {
            return {
              TAG: "Ok",
              _0: Belt_Array.reverse(acc)
            };
          }
          let e = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "y");
          if (e.TAG !== "Ok") {
            return e;
          }
          let e$1 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "x");
          if (e$1.TAG !== "Ok") {
            return e$1;
          }
          let e$2 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "amount");
          if (e$2.TAG !== "Ok") {
            return e$2;
          }
          let e$3 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "liquidType");
          if (e$3.TAG !== "Ok") {
            return e$3;
          }
          _acc = Belt_Array.concatMany([
            [{
                x: e$1._0,
                y: e._0,
                amount: e$2._0,
                liquidType: e$3._0
              }],
            acc
          ]);
          _idx = idx + 1 | 0;
          continue;
        };
      };
      let e$2 = readChanges(0, []);
      if (e$2.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "Liquid",
            _0: {
              changes: e$2._0
            }
          }
        };
      } else {
        return e$2;
      }
    case "Text" :
      if (fromServer) {
        let e$3 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "playerId");
        if (e$3.TAG !== "Ok") {
          return e$3;
        }
        let e$4 = ErrorAwarePacketReader$TerrariaPacket.readNetworkText(reader, "message");
        if (e$4.TAG !== "Ok") {
          return e$4;
        }
        let e$5 = ErrorAwarePacketReader$TerrariaPacket.readColor(reader, "color");
        if (e$5.TAG === "Ok") {
          return {
            TAG: "Ok",
            _0: {
              TAG: "ServerText",
              _0: e$3._0,
              _1: e$4._0,
              _2: e$5._0
            }
          };
        } else {
          return e$5;
        }
      }
      let e$6 = ErrorAwarePacketReader$TerrariaPacket.readString(reader, "commandId");
      if (e$6.TAG !== "Ok") {
        return e$6;
      }
      let e$7 = ErrorAwarePacketReader$TerrariaPacket.readString(reader, "message");
      if (e$7.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "ClientText",
            _0: e$6._0,
            _1: e$7._0
          }
        };
      } else {
        return e$7;
      }
    case "Ping" :
      let e$8 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "x");
      if (e$8.TAG !== "Ok") {
        return e$8;
      }
      let e$9 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "y");
      if (e$9.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "Ping",
            _0: {
              x: e$8._0,
              y: e$9._0
            }
          }
        };
      } else {
        return e$9;
      }
    case "Ambience" :
      let e$10 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "playerId");
      if (e$10.TAG !== "Ok") {
        return e$10;
      }
      let e$11 = ErrorAwarePacketReader$TerrariaPacket.readInt32(reader, "seed");
      if (e$11.TAG !== "Ok") {
        return e$11;
      }
      let e$12 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "skyEntityType");
      if (e$12.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "Ambience",
            _0: {
              playerId: e$10._0,
              seed: e$11._0,
              skyEntityType: e$12._0
            }
          }
        };
      } else {
        return e$12;
      }
    case "Bestiary" :
      let e$13 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "rawBestiaryUnlockType");
      if (e$13.TAG !== "Ok") {
        return e$13;
      }
      let e$14 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "npcId");
      if (e$14.TAG !== "Ok") {
        return e$14;
      }
      let e$15;
      switch (e$13._0) {
        case 0 :
          let e$16 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "killCount");
          e$15 = e$16.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                TAG: "Kill",
                _0: e$16._0
              }
            }) : e$16;
          break;
        case 1 :
          e$15 = {
            TAG: "Ok",
            _0: "Sight"
          };
          break;
        case 2 :
          e$15 = {
            TAG: "Ok",
            _0: "Chat"
          };
          break;
        default:
          e$15 = {
            TAG: "Error",
            _0: {
              context: "Packet_NetModuleLoad.parseBestiary",
              error: makeError("Unknown bestiary unlock type")
            }
          };
      }
      if (e$15.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "Bestiary",
            _0: {
              unlockType: e$15._0,
              npcId: e$14._0
            }
          }
        };
      } else {
        return e$15;
      }
    case "CreativeUnlocks" :
      let e$17 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "itemId");
      if (e$17.TAG !== "Ok") {
        return e$17;
      }
      let e$18 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "researchedCount");
      if (e$18.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "CreativeUnlocks",
            _0: {
              itemId: e$17._0,
              researchedCount: e$18._0
            }
          }
        };
      } else {
        return e$18;
      }
    case "CreativePower" :
      let p = CreativePowers$TerrariaPacket.parse(reader);
      if (p !== undefined) {
        return {
          TAG: "Ok",
          _0: {
            TAG: "CreativePower",
            _0: p
          }
        };
      } else {
        return {
          TAG: "Error",
          _0: {
            context: "Packet_NetModuleLoad.parseCreativePower",
            error: makeError("Failed to parse creative power")
          }
        };
      }
    case "CreativeUnlocksPlayerReport" :
      let e$19 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "unknownByte");
      if (e$19.TAG !== "Ok") {
        return e$19;
      }
      let e$20 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "itemId");
      if (e$20.TAG !== "Ok") {
        return e$20;
      }
      let e$21 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "researchedCount");
      if (e$21.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "CreativeUnlocksPlayerReport",
            _0: {
              itemId: e$20._0,
              researchedCount: e$21._0
            }
          }
        };
      } else {
        return e$21;
      }
    case "TeleportPylon" :
      let e$22 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "rawPylonAction");
      if (e$22.TAG !== "Ok") {
        return e$22;
      }
      let e$23 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "x");
      if (e$23.TAG !== "Ok") {
        return e$23;
      }
      let e$24 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "y");
      if (e$24.TAG !== "Ok") {
        return e$24;
      }
      let e$25 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "pylonType");
      if (e$25.TAG !== "Ok") {
        return e$25;
      }
      let pylonAction;
      switch (e$22._0) {
        case 0 :
          pylonAction = "Added";
          break;
        case 1 :
          pylonAction = "Removed";
          break;
        case 2 :
          pylonAction = "RequestTeleport";
          break;
        default:
          pylonAction = undefined;
      }
      if (pylonAction !== undefined) {
        return {
          TAG: "Ok",
          _0: {
            TAG: "TeleportPylon",
            _0: {
              pylonAction: pylonAction,
              x: e$23._0,
              y: e$24._0,
              pylonType: e$25._0
            }
          }
        };
      } else {
        return {
          TAG: "Error",
          _0: {
            context: "Packet_NetModuleLoad.parseTeleportPylon",
            error: makeError("Unknown pylon action")
          }
        };
      }
    case "Particles" :
      let e$26 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "particleType");
      if (e$26.TAG !== "Ok") {
        return e$26;
      }
      let e$27 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "x");
      if (e$27.TAG !== "Ok") {
        return e$27;
      }
      let e$28 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "y");
      if (e$28.TAG !== "Ok") {
        return e$28;
      }
      let e$29 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vx");
      if (e$29.TAG !== "Ok") {
        return e$29;
      }
      let e$30 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vy");
      if (e$30.TAG !== "Ok") {
        return e$30;
      }
      let e$31 = ErrorAwarePacketReader$TerrariaPacket.readInt32(reader, "shaderIndex");
      if (e$31.TAG !== "Ok") {
        return e$31;
      }
      let e$32 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "invokedByPlayer");
      if (e$32.TAG === "Ok") {
        return {
          TAG: "Ok",
          _0: {
            TAG: "Particles",
            _0: {
              particleType: e$26._0,
              x: e$27._0,
              y: e$28._0,
              vx: e$29._0,
              vy: e$30._0,
              shaderIndex: e$31._0,
              invokedByPlayer: e$32._0
            }
          }
        };
      } else {
        return e$32;
      }
    case "CreativePowerPermissions" :
      let e$33 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "unknownByte");
      if (e$33.TAG !== "Ok") {
        return e$33;
      }
      let e$34 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "powerType");
      if (e$34.TAG !== "Ok") {
        return e$34;
      }
      let e$35 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "rawPowerLevel");
      if (e$35.TAG !== "Ok") {
        return e$35;
      }
      let powerLevel;
      switch (e$35._0) {
        case 0 :
          powerLevel = "LockedForEveryone";
          break;
        case 1 :
          powerLevel = "CanBeChangedByHostAlone";
          break;
        case 2 :
          powerLevel = "CanBeChangedByEveryone";
          break;
        default:
          powerLevel = undefined;
      }
      if (powerLevel !== undefined) {
        return {
          TAG: "Ok",
          _0: {
            TAG: "CreativePowerPermissions",
            _0: {
              powerType: e$34._0,
              powerLevel: powerLevel
            }
          }
        };
      } else {
        return {
          TAG: "Error",
          _0: {
            context: "Packet_NetModuleLoad.parseCreativePowerPermission",
            error: makeError("Unknown creative power permission level")
          }
        };
      }
  }
}

exports.NetModuleType = NetModuleType;
exports.toBuffer = toBuffer;
exports.parse = parse;
/* CreativePowers-TerrariaPacket Not a pure module */
