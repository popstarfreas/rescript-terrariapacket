// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let BitFlags$TerrariaPacket = require("../BitFlags.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function parse(payload) {
  let reader = new Packetreader(payload);
  let e = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "playerId");
  if (e.TAG !== "Ok") {
    return e;
  }
  let e$1 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "controlFlags");
  if (e$1.TAG !== "Ok") {
    return e$1;
  }
  let controlFlags = BitFlags$TerrariaPacket.fromByte(e$1._0);
  let e$2 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "miscFlags1");
  if (e$2.TAG !== "Ok") {
    return e$2;
  }
  let miscFlags1 = BitFlags$TerrariaPacket.fromByte(e$2._0);
  let e$3 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "miscFlags2");
  if (e$3.TAG !== "Ok") {
    return e$3;
  }
  let miscFlags2 = BitFlags$TerrariaPacket.fromByte(e$3._0);
  let e$4 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "miscFlags3");
  if (e$4.TAG !== "Ok") {
    return e$4;
  }
  let miscFlags3 = BitFlags$TerrariaPacket.fromByte(e$4._0);
  let control_isHoldingUp = BitFlags$TerrariaPacket.flag1(controlFlags);
  let control_isHoldingDown = BitFlags$TerrariaPacket.flag2(controlFlags);
  let control_isHoldingLeft = BitFlags$TerrariaPacket.flag3(controlFlags);
  let control_isHoldingRight = BitFlags$TerrariaPacket.flag4(controlFlags);
  let control_isHoldingJump = BitFlags$TerrariaPacket.flag5(controlFlags);
  let control_isHoldingItemUse = BitFlags$TerrariaPacket.flag6(controlFlags);
  let control = {
    isHoldingUp: control_isHoldingUp,
    isHoldingDown: control_isHoldingDown,
    isHoldingLeft: control_isHoldingLeft,
    isHoldingRight: control_isHoldingRight,
    isHoldingJump: control_isHoldingJump,
    isHoldingItemUse: control_isHoldingItemUse
  };
  let direction = BitFlags$TerrariaPacket.flag7(controlFlags) ? "Right" : "Left";
  let pulleyDirection = BitFlags$TerrariaPacket.flag1(miscFlags1) ? (
      BitFlags$TerrariaPacket.flag2(miscFlags1) ? "Two" : "One"
    ) : undefined;
  let vortexStealthActive = BitFlags$TerrariaPacket.flag4(miscFlags1);
  let gravityDirection = BitFlags$TerrariaPacket.flag5(miscFlags1) ? "Normal" : "Inverted";
  let shouldGuard = BitFlags$TerrariaPacket.flag6(miscFlags1);
  let ghost = BitFlags$TerrariaPacket.flag7(miscFlags1);
  let e$5 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "selectedItem");
  if (e$5.TAG !== "Ok") {
    return e$5;
  }
  let e$6 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "positionX");
  if (e$6.TAG !== "Ok") {
    return e$6;
  }
  let e$7 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "positionY");
  if (e$7.TAG !== "Ok") {
    return e$7;
  }
  let position_x = e$6._0;
  let position_y = e$7._0;
  let position = {
    x: position_x,
    y: position_y
  };
  let e$8;
  if (BitFlags$TerrariaPacket.flag3(miscFlags1)) {
    let e$9 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "velocityX");
    if (e$9.TAG === "Ok") {
      let e$10 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "velocityY");
      e$8 = e$10.TAG === "Ok" ? ({
          TAG: "Ok",
          _0: {
            x: e$9._0,
            y: e$10._0
          }
        }) : e$10;
    } else {
      e$8 = e$9;
    }
  } else {
    e$8 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  if (e$8.TAG !== "Ok") {
    return e$8;
  }
  let e$11;
  if (BitFlags$TerrariaPacket.flag7(miscFlags2)) {
    let e$12 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "potionOfReturnOrigX");
    if (e$12.TAG === "Ok") {
      let e$13 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "potionOfReturnOrigY");
      if (e$13.TAG === "Ok") {
        let e$14 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "potionOfReturnHomeX");
        if (e$14.TAG === "Ok") {
          let e$15 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "potionOfReturnHomeY");
          e$11 = e$15.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                originalUsePosition: {
                  x: e$12._0,
                  y: e$13._0
                },
                homePosition: {
                  x: e$14._0,
                  y: e$15._0
                }
              }
            }) : e$15;
        } else {
          e$11 = e$14;
        }
      } else {
        e$11 = e$13;
      }
    } else {
      e$11 = e$12;
    }
  } else {
    e$11 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  if (e$11.TAG !== "Ok") {
    return e$11;
  }
  let tryKeepingHoveringUp = BitFlags$TerrariaPacket.flag1(miscFlags2);
  let isVoidVaultEnabled = BitFlags$TerrariaPacket.flag2(miscFlags2);
  let isSitting = BitFlags$TerrariaPacket.flag3(miscFlags2);
  let hasFinishedAnyDd2Event = BitFlags$TerrariaPacket.flag4(miscFlags2);
  let isPettingAnimal = BitFlags$TerrariaPacket.flag5(miscFlags2);
  let isTheAnimalBeingPetSmall = BitFlags$TerrariaPacket.flag6(miscFlags2);
  let tryKeepingHoveringDown = BitFlags$TerrariaPacket.flag8(miscFlags2);
  let isSleeping = BitFlags$TerrariaPacket.flag1(miscFlags3);
  return {
    TAG: "Ok",
    _0: {
      playerId: e._0,
      control: control,
      direction: direction,
      pulleyDirection: pulleyDirection,
      vortexStealthActive: vortexStealthActive,
      gravityDirection: gravityDirection,
      shouldGuard: shouldGuard,
      ghost: ghost,
      selectedItem: e$5._0,
      position: position,
      velocity: e$8._0,
      potionOfReturn: e$11._0,
      tryKeepingHoveringUp: tryKeepingHoveringUp,
      isVoidVaultEnabled: isVoidVaultEnabled,
      isSitting: isSitting,
      hasFinishedAnyDd2Event: hasFinishedAnyDd2Event,
      isPettingAnimal: isPettingAnimal,
      isTheAnimalBeingPetSmall: isTheAnimalBeingPetSmall,
      tryKeepingHoveringDown: tryKeepingHoveringDown,
      isSleeping: isSleeping
    }
  };
}

function packControlFlags(writer, control, direction) {
  let tmp;
  tmp = direction !== "Left";
  return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(control.isHoldingUp, control.isHoldingDown, control.isHoldingLeft, control.isHoldingRight, control.isHoldingJump, control.isHoldingItemUse, tmp, false)), "controlFlags");
}

function packMiscFlags1(writer, pulleyDirection, velocity, vortexStealthActive, gravityDirection, shouldGuard, ghost) {
  let tmp;
  tmp = pulleyDirection !== undefined ? pulleyDirection !== "One" : false;
  let tmp$1;
  tmp$1 = gravityDirection === "Normal";
  return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(pulleyDirection !== undefined, tmp, velocity !== undefined, vortexStealthActive, tmp$1, shouldGuard, ghost, false)), "miscFlags1");
}

function packMiscFlags2(writer, tryKeepingHoveringUp, isVoidVaultEnabled, isSitting, hasFinishedAnyDd2Event, isPettingAnimal, isTheAnimalBeingPetSmall, potionOfReturn, tryKeepingHoveringDown) {
  return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(tryKeepingHoveringUp, isVoidVaultEnabled, isSitting, hasFinishedAnyDd2Event, isPettingAnimal, isTheAnimalBeingPetSmall, potionOfReturn !== undefined, tryKeepingHoveringDown)), "miscFlags2");
}

function packMiscFlags3(writer, isSleeping) {
  return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(isSleeping, false, false, false, false, false, false, false)), "miscFlags3");
}

function packVelocity(writer, velocity) {
  if (velocity !== undefined) {
    return ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, velocity.x, "velocityX"), velocity.y, "velocityY");
  } else {
    return writer;
  }
}

function packPotionOfReturn(writer, potionOfReturn) {
  if (potionOfReturn !== undefined) {
    return ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, potionOfReturn.originalUsePosition.x, "potionOfReturnOrigX"), potionOfReturn.originalUsePosition.y, "potionOfReturnOrigY"), potionOfReturn.homePosition.x, "potionOfReturnHomeX"), potionOfReturn.homePosition.y, "potionOfReturnHomeY");
  } else {
    return writer;
  }
}

function toBuffer(self) {
  return ErrorAwarePacketWriter$TerrariaPacket.data(packPotionOfReturn(packVelocity(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packByte(packMiscFlags3(packMiscFlags2(packMiscFlags1(packControlFlags(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("PlayerUpdate")), self.playerId, "playerId"), self.control, self.direction), self.pulleyDirection, self.velocity, self.vortexStealthActive, self.gravityDirection, self.shouldGuard, self.ghost), self.tryKeepingHoveringUp, self.isVoidVaultEnabled, self.isSitting, self.hasFinishedAnyDd2Event, self.isPettingAnimal, self.isTheAnimalBeingPetSmall, self.potionOfReturn, self.tryKeepingHoveringDown), self.isSleeping), self.selectedItem, "selectedItem"), self.position.x, "positionX"), self.position.y, "positionY"), self.velocity), self.potionOfReturn));
}

exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
