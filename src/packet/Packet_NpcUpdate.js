// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

let Belt_Option = require("@rescript/runtime/lib/js/Belt_Option.js");
let Stdlib_Result = require("@rescript/runtime/lib/js/Stdlib_Result.js");
let BitFlags$TerrariaPacket = require("../BitFlags.js");
let PacketType$TerrariaPacket = require("../PacketType.js");
let ErrorAwarePacketReader$TerrariaPacket = require("../ErrorAwarePacketReader.js");
let ErrorAwarePacketWriter$TerrariaPacket = require("../ErrorAwarePacketWriter.js");
let Packetreader = require("@popstarfreas/packetfactory/packetreader").default;

function readNpcFlags1(reader, fieldName) {
  let e = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, fieldName);
  if (e.TAG !== "Ok") {
    return e;
  }
  let flags = BitFlags$TerrariaPacket.fromByte(e._0);
  return {
    TAG: "Ok",
    _0: {
      directionX: BitFlags$TerrariaPacket.flag1(flags),
      directionY: BitFlags$TerrariaPacket.flag2(flags),
      ai0: BitFlags$TerrariaPacket.flag3(flags),
      ai1: BitFlags$TerrariaPacket.flag4(flags),
      ai2: BitFlags$TerrariaPacket.flag5(flags),
      ai3: BitFlags$TerrariaPacket.flag6(flags),
      spriteDirection: BitFlags$TerrariaPacket.flag7(flags),
      lifeMax: BitFlags$TerrariaPacket.flag8(flags)
    }
  };
}

function readNpcFlags2(reader, fieldName) {
  let e = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, fieldName);
  if (e.TAG !== "Ok") {
    return e;
  }
  let flags = BitFlags$TerrariaPacket.fromByte(e._0);
  return {
    TAG: "Ok",
    _0: {
      statsScaled: BitFlags$TerrariaPacket.flag1(flags),
      spawnedFromStatue: BitFlags$TerrariaPacket.flag2(flags),
      strengthMultiplier: BitFlags$TerrariaPacket.flag3(flags)
    }
  };
}

function parse(payload) {
  let reader = new Packetreader(payload);
  let e = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "npcSlotId");
  if (e.TAG !== "Ok") {
    return e;
  }
  let e$1 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "x");
  if (e$1.TAG !== "Ok") {
    return e$1;
  }
  let e$2 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "y");
  if (e$2.TAG !== "Ok") {
    return e$2;
  }
  let e$3 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vx");
  if (e$3.TAG !== "Ok") {
    return e$3;
  }
  let e$4 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "vy");
  if (e$4.TAG !== "Ok") {
    return e$4;
  }
  let e$5 = ErrorAwarePacketReader$TerrariaPacket.readUInt16(reader, "target");
  if (e$5.TAG !== "Ok") {
    return e$5;
  }
  let e$6 = readNpcFlags1(reader, "npcFlags1");
  if (e$6.TAG !== "Ok") {
    return e$6;
  }
  let npcFlags1 = e$6._0;
  let e$7 = readNpcFlags2(reader, "npcFlags2");
  if (e$7.TAG !== "Ok") {
    return e$7;
  }
  let npcFlags2 = e$7._0;
  let tmp;
  if (npcFlags1.ai0) {
    let e$8 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai0");
    tmp = e$8.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$8._0
      }) : e$8;
  } else {
    tmp = {
      TAG: "Ok",
      _0: undefined
    };
  }
  let tmp$1;
  if (npcFlags1.ai1) {
    let e$9 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai1");
    tmp$1 = e$9.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$9._0
      }) : e$9;
  } else {
    tmp$1 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  let tmp$2;
  if (npcFlags1.ai2) {
    let e$10 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai2");
    tmp$2 = e$10.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$10._0
      }) : e$10;
  } else {
    tmp$2 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  let tmp$3;
  if (npcFlags1.ai3) {
    let e$11 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "ai3");
    tmp$3 = e$11.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$11._0
      }) : e$11;
  } else {
    tmp$3 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  let e$12 = Stdlib_Result.all4([
    tmp,
    tmp$1,
    tmp$2,
    tmp$3
  ]);
  if (e$12.TAG !== "Ok") {
    return e$12;
  }
  let e$13 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "npcTypeId");
  if (e$13.TAG !== "Ok") {
    return e$13;
  }
  let e$14;
  if (npcFlags2.statsScaled) {
    let e$15 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "playerCountScale");
    e$14 = e$15.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$15._0
      }) : e$15;
  } else {
    e$14 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  if (e$14.TAG !== "Ok") {
    return e$14;
  }
  let e$16;
  if (npcFlags2.strengthMultiplier) {
    let e$17 = ErrorAwarePacketReader$TerrariaPacket.readSingle(reader, "strengthMultiplier");
    e$16 = e$17.TAG === "Ok" ? ({
        TAG: "Ok",
        _0: e$17._0
      }) : e$17;
  } else {
    e$16 = {
      TAG: "Ok",
      _0: undefined
    };
  }
  if (e$16.TAG !== "Ok") {
    return e$16;
  }
  let e$18;
  if (npcFlags1.lifeMax) {
    e$18 = {
      TAG: "Ok",
      _0: "Max"
    };
  } else {
    let e$19 = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "lifeBytes");
    if (e$19.TAG === "Ok") {
      switch (e$19._0) {
        case 1 :
          let e$20 = ErrorAwarePacketReader$TerrariaPacket.readSByte(reader, "life_sbyte");
          e$18 = e$20.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                TAG: "Byte",
                _0: e$20._0
              }
            }) : e$20;
          break;
        case 2 :
          let e$21 = ErrorAwarePacketReader$TerrariaPacket.readInt16(reader, "life_int16");
          e$18 = e$21.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                TAG: "Int16",
                _0: e$21._0
              }
            }) : e$21;
          break;
        case 4 :
          let e$22 = ErrorAwarePacketReader$TerrariaPacket.readInt32(reader, "life_int32");
          e$18 = e$22.TAG === "Ok" ? ({
              TAG: "Ok",
              _0: {
                TAG: "Int32",
                _0: e$22._0
              }
            }) : e$22;
          break;
        default:
          e$18 = {
            TAG: "Error",
            _0: {
              context: "Packet_NpcUpdate.parse",
              error: new Error("Invalid life byte count")
            }
          };
      }
    } else {
      e$18 = e$19;
    }
  }
  if (e$18.TAG !== "Ok") {
    return e$18;
  }
  let releaseOwner = ErrorAwarePacketReader$TerrariaPacket.readByte(reader, "releaseOwner");
  let releaseOwner$1;
  releaseOwner$1 = releaseOwner.TAG === "Ok" ? releaseOwner._0 : undefined;
  return {
    TAG: "Ok",
    _0: {
      npcSlotId: e._0,
      npcTypeId: e$13._0,
      x: e$1._0,
      y: e$2._0,
      vx: e$3._0,
      vy: e$4._0,
      target: e$5._0,
      directionX: npcFlags1.directionX,
      directionY: npcFlags1.directionY,
      ai: e$12._0,
      spriteDirection: npcFlags1.spriteDirection,
      life: e$18._0,
      releaseOwner: releaseOwner$1,
      playerCountScale: e$14._0,
      strengthMultiplier: e$16._0,
      spawnedFromStatue: npcFlags2.spawnedFromStatue
    }
  };
}

function npcFlags1(self) {
  let match = self.ai;
  return BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(self.directionX, self.directionY, Belt_Option.isSome(match[0]), Belt_Option.isSome(match[1]), Belt_Option.isSome(match[2]), Belt_Option.isSome(match[3]), self.spriteDirection, self.life === "Max"));
}

function npcFlags2(self) {
  return BitFlags$TerrariaPacket.toByte(BitFlags$TerrariaPacket.fromFlags(Belt_Option.isSome(self.playerCountScale), self.spawnedFromStatue, Belt_Option.isSome(self.strengthMultiplier), false, false, false, false, false));
}

function packAi(writer, param) {
  let ai3 = param[3];
  let ai2 = param[2];
  let ai1 = param[1];
  let ai0 = param[0];
  if (ai0 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai0, "ai0");
  }
  if (ai1 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai1, "ai1");
  }
  if (ai2 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai2, "ai2");
  }
  if (ai3 !== undefined) {
    ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, ai3, "ai3");
  }
  return writer;
}

function packPlayerCountScale(writer, playerCountScale) {
  if (playerCountScale !== undefined) {
    return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, playerCountScale, "playerCountScale");
  } else {
    return writer;
  }
}

function packStrengthMultiplier(writer, strengthMultiplier) {
  if (strengthMultiplier !== undefined) {
    return ErrorAwarePacketWriter$TerrariaPacket.packSingle(writer, strengthMultiplier, "strengthMultiplier");
  } else {
    return writer;
  }
}

function packLife(writer, life) {
  if (typeof life !== "object") {
    return writer;
  }
  switch (life.TAG) {
    case "Byte" :
      return ErrorAwarePacketWriter$TerrariaPacket.packSByte(ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, 1, "lifeBytes"), life._0, "life_sbyte");
    case "Int16" :
      return ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, 2, "lifeBytes"), life._0, "life_int16");
    case "Int32" :
      return ErrorAwarePacketWriter$TerrariaPacket.packInt32(ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, 4, "lifeBytes"), life._0, "life_int32");
  }
}

function packReleaseOwner(writer, releaseOwner) {
  if (releaseOwner !== undefined) {
    return ErrorAwarePacketWriter$TerrariaPacket.packByte(writer, releaseOwner, "releaseOwner");
  } else {
    return writer;
  }
}

function toBuffer(self) {
  return ErrorAwarePacketWriter$TerrariaPacket.data(packReleaseOwner(packLife(packStrengthMultiplier(packPlayerCountScale(ErrorAwarePacketWriter$TerrariaPacket.packInt16(packAi(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packByte(ErrorAwarePacketWriter$TerrariaPacket.packUInt16(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packSingle(ErrorAwarePacketWriter$TerrariaPacket.packInt16(ErrorAwarePacketWriter$TerrariaPacket.setType(ErrorAwarePacketWriter$TerrariaPacket.make(), PacketType$TerrariaPacket.toInt("NpcUpdate")), self.npcSlotId, "npcSlotId"), self.x, "x"), self.y, "y"), self.vx, "vx"), self.vy, "vy"), self.target, "target"), npcFlags1(self), "npcFlags1"), npcFlags2(self), "npcFlags2"), self.ai), self.npcTypeId, "npcTypeId"), self.playerCountScale), self.strengthMultiplier), self.life), self.releaseOwner));
}

exports.parse = parse;
exports.toBuffer = toBuffer;
/* ErrorAwarePacketWriter-TerrariaPacket Not a pure module */
